/* @flow */

export type PatchDefinition = {
    name: string;
    // TODO
}

export type NodeDefinition = {
    name: string;
    // TODO
}

export type NodeRenderDefinition = {
    name: string;
    // TODO
}

export type InletDefinition = {
    name: string;
    // TODO
}

export type InletRenderDefinition = {
    name: string;
    // TODO
}

export type OutletDefinition = {
    name: string;
    // TODO
}

export type OutletRenderDefinition = {
    name: string;
    // TODO
}

export type ChannelDefiniton = InletDefinition | OutletDefinition;

export type RendererConfig = {
}

export type KefirStream = { /* TODO */ }

declare class Patch {
    Patch(name: string, def?: PatchDefinition): Patch;
    render(aliases: Array<string>, targets: Array<string>, config?: RendererConfig): Patch;
    render(alias: string, target: string, config?: RendererConfig): Patch;
    addNode(type: string, title: string, def?: NodeDefinition): Node;
    // TODO: more addNode variations
    removeNode(node: Node): Patch;
    open(parent: Patch): Patch;
    close(): Patch;
    inputs(list: Array<Inlet>): Patch;
    outputs(list: Array<Outlet>): Patch;
    project(node: Node): Patch;
    moveCanvas(x: number, y: number): Patch;
    resizeCanvas(width: number, height: number): Patch;
}

declare class Node {
    Node(type: string, patch: Patch, def?: NodeDefinition, render?: NodeRenderDefinition, callback?: (node: Node) => void): Node;
    turnOn(): Node;
    turnOff(): Node;
    addInlet(type: string, alias: string, def?: InletDefinition): Inlet;
    // TODO: more addInlet variations
    addOutlet(type: string, alias: string, def?: OutletDefinition): Outlet;
    // TODO: more addOutlet variations
    removeInlet(inlet: Inlet): Node;
    removeOutlet(outlet: Outlet): Node;
    move(x: number, y: number): Node;
};

declare class Inlet {
    Inlet(type: string, node: Node, alias?: string, def?: InletDefinition, render?: InletRenderDefinition): Inlet;
    receive(value: any): Inlet; // FIXME: value: any except KefirStream
    stream(stream: KefirStream): Inlet;
    toDefault(): Inlet;
    allows(outlet: Outlet): boolean;
};

declare class Outlet {
    Outlet(type: string, node: Node, alias?: string, def?: OutletDefinition, render?: OutletRenderDefinition): Outlet;
    connect(inlet: Inlet): Link;
    disconnect(link: Link): Outlet;
    send(value: any): Outlet; // FIXME: value: any except KefirStream
    stream(stream: KefirStream): Outlet;
    toDefault(): Outlet;
};

declare class Link {
    Link(outlet: Outlet, inlet: Inlet, label?: string): Link;
    pass(value: any): Link;
    enable(): Link;
    disable(): Link;
    disconnect(): Link;
};

declare var HiddenTypes : {
    Patch: typeof Patch;
}

declare var Rpd : {
    _: typeof HiddenTypes;

    // FIXME: remove this block later
    Patch: typeof Patch;

    addPatch(): Patch;
};

module.exports = Rpd;
