<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">

        <script src="../vendor/kefir.min.js"></script>

        <script src="../src/rpd.js"></script>

        <script src="../src/render/html.js"></script>
        <link rel="stylesheet" href="../src/render/html.css"></style>

        <script src="../src/toolkit/core/toolkit.js"></script>
        <script src="../src/toolkit/core/render/html.js"></script>
        <link rel="stylesheet" href="../src/toolkit/core/render/html.css"></link>
    </head>

    <body>
        <!-- <script>
            Rpd.channeltype('core/any');

            Rpd.nodetype('foo/test', {
                inlets: {
                    in: { type: 'core/any', hidden: true }
                },
                process: function(inlets) {
                    if (!inlets.bar) {
                        console.log('once');
                        this.addInlet('core/any', 'bar').receive(2);
                    }
                }
            });

            var root = Rpd.Model.start('root').attachTo(document.body).renderWith('html');

            var fooNode = new Rpd.Node('foo/test', 'Foo');
            fooNode.inlets['in'].receive({});

        </script> -->
        <script>
            var root = Rpd.Model.start('root').render('html', document.body, { /* layout: 'pd' */ })
                                              .enter();

            var genA = root.addNode('core/custom', 'Generate A');
            var outA = genA.addOutlet('core/number', 'A');

            var genA = root.addNode('core/custom', 'Generate B');
            var outB = genA.addOutlet('core/number', 'B', '', 1);

            var sum = Rpd.Model.start('sum').render('html', document.body, { /* layout: 'pd' */ });

            var sumOfThree1 = sum.addNode('core/sum-of-three', 'Sum1');
            var in1A = sumOfThree1.inlets['a'];
            var in1B = sumOfThree1.inlets['b'];
            var sum1 = sumOfThree1.outlets['sum'];

            var sumOfThree2 = sum.addNode('core/sum-of-three', 'Sum2');
            var in2A = sumOfThree2.inlets['a'];
            var sum2 = sumOfThree2.outlets['sum'];

            sum1.connect(in2A);

            sum.inputs([ in1A, in1B ]);
            sum.outputs([ sum2 ]);

            //root.connect(sum);

            // var p = root.addNode('core/model-ref', 'SumPatch');
            // p.inlets['model'].receive(sum);

            var p = root.addNode('core/custom');
            sum.project(p);

            //outA.stream(Kefir.repeatedly(10, [1, 2, 3]));
            //outB.stream(Kefir.repeatedly(20, [4, 5, 6]));

        </script>
        <!-- <script>

            let stream1 = $('button')[0]
            let clicks1 = Kefir.fromEvent(stream1, 'click')
            clicks1 = clicks1.toProperty(0).scan((prev, next) => prev+1)
            clicks1.log('stream1')
            let stream2 = $('button')[1]
            let clicks2 = Kefir.fromEvent(stream2, 'click')
            clicks2 = Kefir.combine([ clicks2 ], [ clicks1 ])
            clicks2.log('stream2')

        </script> -->
    </body>
</html>
