/**
 * rpd - RPD is a minimal framework for building Node-Based User Interfaces, powered by Reactive Programming
 * Built at Sat, 12 Dec 2015 09:21:03 GMT
 *
 * @version v0.2.0
 * @link http://shamansir.github.io/rpd
 * @author Ulric Wilfred <shaman.sir@gmail.com>
 * @license MIT
 * 
 * Selected Renderers: html
 * Selected Styles: quartz
 * Selected Toolkits: core, timbre
 * Selected I/O Modules: [None]
 * d3.js or d3_tiny.js: d3_tiny.js
 *
 * User Styles: [None]
 * User Toolkits: [None]
 *
 * Command: gulp --root . --renderer html --style quartz --toolkit core --toolkit timbre --target-name rpd-timbre --compilation simple
 */
(function(b){var d=b.Kefir;"undefined"===typeof d&&"undefined"!==typeof require&&(d=require("../vendor/kefir.min.js"));if(!d)throw Error("Kefir.js (https://github.com/rpominov/kefir) is required for Rpd to work");var a=function(){function e(c){return function(){return c}}function b(c){this.id=u();this.name=c;var a=this;c={"patch/is-ready":[],"patch/enter":[],"patch/exit":[],"patch/set-inputs":["inputs"],"patch/set-outputs":["outputs"],"patch/project":["node","target"],"patch/refer":["node","target"],
"patch/add-node":["node"],"patch/remove-node":["node"]};this.event=v(c);this.events=w(c,this.event,"patch",this);this.renderQueue=d.emitter();c=d.combine([this.events],[this.renderQueue.scan(function(c,g){var n=g.alias,b=g.target,p=g.config,d=c[n];d||(d={},d.produce=K[n](a),d.handlers=[],c[n]=d);if(d.produce){var e=d.produce(b,p);e&&d.handlers.push("function"===typeof e?e:function(c){if(e[c.type])e[c.type](c)})}return c},{})]);c=c.bufferBy(this.renderQueue).take(1).flatten().concat(c);c.onValue(function(c){var g=
c[0];c=c[1];for(var n=Object.keys(c),a,x=0,d=n.length;x<d;x++){a=c[n[x]];a=a.handlers;for(var b=0,e=a.length;b<e;b++)a[b](C(D(g),n[x]))}});this.projections=d.emitter();d.combine([this.projections],[this.event["patch/set-inputs"],this.event["patch/set-outputs"]]).onValue(function(c){var g=c[0],n=c[1];c=c[2];for(var b,d=0;d<n.length;d++)b=g.addInlet(n[d].type,n[d].name),b.event["inlet/update"].onValue(function(c){return function(g){c.receive(g)}}(n[d]));for(d=0;d<c.length;d++)n=g.addOutlet(c[d].type,
c[d].name),c[d].event["outlet/update"].onValue(function(c){return function(g){c.send(g)}}(n));a.event["patch/project"].emit({node:g,target:g.patch});g.patch.event["patch/refer"].emit({node:g,target:a})});this.nodesToRemove=d.emitter();this.event["patch/is-ready"].emit()}function f(c,a,b,g){this.type=c||"core/empty";this.id=u();var n=z(y[this.type],this);n||E("Node type "+this.type+" is not registered!");this.def=n;this.name=b||n.name||c;this.patch=a;this.render=p(A[this.type],this);c={"node/turn-on":[],
"node/is-ready":[],"node/process":["inlets","outlets"],"node/turn-off":[],"node/add-inlet":["inlet"],"node/remove-inlet":["inlet"],"node/add-outlet":["outlet"],"node/remove-outlet":["outlet"],"node/move":["position"]};this.event=v(c);this.events=w(c,this.event,"node",this);g&&g(this);var e=this;if(this.def.handle)this.events.onValue(function(c){if(e.def.handle[c.type])e.def.handle[c.type](c)});if(this.def.process){var h=this.def.process;g=d.combine([this.event["node/add-inlet"].flatMap(function(c){var g=
c.event["inlet/update"].map(function(g){return{inlet:c,value:g}});e.def.tune&&(g=e.def.tune(g));return g})],[this.event["node/add-outlet"].scan(function(c,g){c[g.alias]=g;return c},{})]);g=g.bufferBy(this.event["node/is-ready"]).take(1).flatten().concat(g);g=g.scan(function(c,g){var n=g[0].inlet,a=n.alias;c.inlets.prev[a]=c.inlets.cur[a];c.inlets.cur[a]=g[0].value;c.outlets=g[1];c.source=n;return c},{inlets:{prev:{},cur:{}},outlets:{}}).changes();g=g.filter(function(c){return!c.source.cold});g.onValue(function(c){var g=
h.bind(e)(c.inlets.cur,c.inlets.prev);e.event["node/process"].emit({inlets:c.inlets.cur,outlets:g});c=c.outlets;for(var n in g)c[n]&&(g[n]instanceof d.Stream?c[n].stream(g[n]):c[n].send(g[n]))})}if(this.def.inlets){this.inlets={};for(var m in this.def.inlets)g=this.def.inlets[m],g=this.addInlet(g.type,m,g.name,g.default,g.hidden,g.readonly,g.cold),this.inlets[m]=g}if(this.def.outlets)for(m in this.outlets={},this.def.outlets)g=this.def.outlets[m],g=this.addOutlet(g.type,m,g.name,g.default),this.outlets[m]=
g;this.def.prepare&&this.def.prepare(this.inlets,this.outlets);this.event["node/is-ready"].emit()}function m(c,a,b,g,n,e,h,m){this.type=c||"core/any";this.id=u();var f=z(F[this.type],this);f||E("Channel type "+this.type+" is not registered!");this.def=f;(this.alias=b||f.alias||g)||E("Inlet should have either alias or name");this.name=g||f.name||this.alias||c;this.node=a;this.hidden=e||!1;this.readonly=q(h||f.readonly)?h||f.readonly:!0;this.cold=m||!1;this.default=q(n)?n:f.default;this.value=d.pool();
this.render=p(G[this.type],this);c={"inlet/update":["value"]};this.event=v(c);var l=this.event["inlet/update"];a=l.merge(this.value);f.tune&&(a=f.tune(a));f.accept&&(a=a.flatten(function(c){if(f.accept(c))return[c];l.error();return[]}));f.adapt&&(a=a.map(f.adapt));this.event["inlet/update"]=a.onValue(function(){});this.events=w(c,this.event,"inlet",this)}function k(c,a,b,g,n){this.type=c||"core/any";this.id=u();var e=z(F[this.type],this);e||E("Channel type "+this.type+" is not registered!");this.def=
e;(this.alias=b||e.alias||g)||E("Outlet should have either alias or name");this.name=g||this.alias||e.name||c;this.node=a;this.default=q(n)?n:e.default;this.value=d.pool();this.render=p(G[this.type],this);c={"outlet/update":["value"],"outlet/connect":["link","inlet"],"outlet/disconnect":["link"]};this.event=v(c);a=this.event["outlet/update"].merge(this.value);this.event["outlet/update"]=a.onValue(function(c){});this.events=w(c,this.event,"outlet",this);var h=this;d.combine([this.event["outlet/connect"]],
[this.event["outlet/update"]]).onValue(function(c){h.value.plug(d.constant(c[1]))})}function h(c,a,b){this.id=u();this.name=b||"";this.outlet=c;this.inlet=a;this.value=d.emitter();var g=this;this.receiver=c.node.id!==a.node.id?function(c){g.pass(c)}:function(c){setTimeout(function(){g.pass(c)},0)};c={"link/enable":[],"link/disable":[],"link/pass":["value"]};this.event=v(c);b=this.event["link/pass"].merge(this.value);this.event["link/pass"]=b.onValue(function(c){});this.events=w(c,this.event,"link",
this);this.enabled=d.merge([this.event["link/disable"].map(e(!1)),this.event["link/enable"].map(e(!0))]).toProperty(e(!0));this.event["link/pass"].filterBy(this.enabled).onValue(function(c){a.receive(c)});d.combine([this.event["link/enable"]],[this.event["link/pass"]]).onValue(function(c){g.pass(c[1])})}function D(c){for(var a={},b=Object.keys(c),g=0,n=b.length;g<n;g++)a[b[g]]=c[b[g]];return a}function q(c){return"undefined"!==typeof c}function z(c,a){return c?"function"===typeof c?c(a):c:null}function p(c,
a){if(!c)return{};var b={},g;for(g in c)b[g]=z(c[g],a);return b}function v(c){var a={};c=Object.keys(c);for(var b=0,g;b<c.length;b++)g=c[b],a[g]=d.emitter();return a}function I(c,a){if(0===a.length)return function(){return{type:c}};if(1===a.length)return function(b){var g={};g.type=c;g[a[0]]=b;return g};if(1<a.length)return function(a){a=D(a);a.type=c;return a}}function w(c,a,b,g){for(var n=d.pool(),e=Object.keys(c),p=0;p<e.length;p++)n.plug(a[e[p]].map(I(e[p],c[e[p]])).map(function(c){c[b]=g;return c}));
return n}function E(c,a){throw a||Error(c);}function u(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}function C(c,a){var b=c.type;if("patch/add-node"===b||"node/process"===b)c.render=c.node.render[a]||{};else if("node/add-inlet"===b||"inlet/update"===b)c.render=c.inlet.render[a]||{};else if("node/add-outlet"===b||"outlet/update"===b)c.render=c.outlet.render[a]||{};return c}(function(){d.emitter=function(){var c,a=d.stream(function(a){c=a;return function(){c=void 0}});a.emit=
function(a){c&&c.emit(a);return this};a.error=function(a){c&&c.error(a);return this};a.end=function(){c&&c.end();return this};a.emitEvent=function(a){c&&c.emitEvent(a);return this};return a.setName("emitter")}})();var y={},F={},A={},G={},J={},B={},K={},M={"network/add-patch":["patch"]},H=v(M),t=w(M,H,"network",a);H["network/add-patch"].onValue(function(c){t.plug(c.events)});var r=d.emitter();b.prototype.render=function(c,a,b){c=Array.isArray(c)?c:[c];a=Array.isArray(a)?a:[a];for(var g=0,n=c.length,
e;g<n;g++)for(var d=0,p=a.length,h;d<p;d++){e=c[g];h=a[d];if(!K[e])throw Error("Renderer "+e+" is not registered");this.renderQueue.emit({alias:e,target:h,config:b})}return this};b.prototype.addNode=function(c,a){var b=this;return new f(c,this,a,function(c){b.events.plug(c.events);b.event["patch/add-node"].emit(c);c.turnOn()})};b.prototype.removeNode=function(c){c.turnOff();this.event["patch/remove-node"].emit(c);this.events.unplug(c.events)};b.prototype.enter=function(){this.event["patch/enter"].emit();
return this};b.prototype.exit=function(){this.event["patch/exit"].emit();return this};b.prototype.inputs=function(c){this.event["patch/set-inputs"].emit(c)};b.prototype.outputs=function(c){this.event["patch/set-outputs"].emit(c)};b.prototype.project=function(c){this.projections.emit(c)};f.prototype.turnOn=function(){this.event["node/turn-on"].emit()};f.prototype.turnOff=function(){this.event["node/turn-off"].emit()};f.prototype.addInlet=function(c,a,b,g,n,e,d){c=new m(c,this,a,b,g,n,e,d);this.events.plug(c.events);
this.event["node/add-inlet"].emit(c);c.toDefault();return c};f.prototype.addOutlet=function(c,a,b,g){c=new k(c,this,a,b,g);this.events.plug(c.events);this.event["node/add-outlet"].emit(c);c.toDefault();return c};f.prototype.removeInlet=function(c){this.event["node/remove-inlet"].emit(c);this.events.unplug(c.events)};f.prototype.removeOutlet=function(c){this.event["node/remove-outlet"].emit(c);this.events.unplug(c.events)};f.prototype.move=function(c,a){this.event["node/move"].emit([c,a]);return this};
m.prototype.receive=function(c){this.value.plug(d.constant(c))};m.prototype.stream=function(c){this.value.plug(c)};m.prototype.toDefault=function(){q(this.default)&&(this.default instanceof d.Stream?this.stream(this.default):this.receive(this.default))};m.prototype.allows=function(c){if(c.type===this.type)return!0;if(!this.def.allow&&c.type!==this.type)return!1;if(this.def.allow){var a=!1;this.def.allow.forEach(function(b){c.type===b&&(a=!0)});return a}return!0};k.prototype.connect=function(c){if(!c.allows(this))throw Error("Outlet of type "+
this.type+" is not allowed to connect to inlet of type "+c.type);var a=new h(this,c);this.events.plug(a.events);this.value.onValue(a.receiver);this.event["outlet/connect"].emit({link:a,inlet:c});return a};k.prototype.disconnect=function(c){this.event["outlet/disconnect"].emit(c);this.value.offValue(c.receiver);this.events.unplug(c.events);return this};k.prototype.send=function(c){this.value.plug(d.constant(c))};k.prototype.stream=function(c){this.value.plug(c)};k.prototype.toDefault=function(){q(this.default)&&
(this.default instanceof d.Stream?this.stream(this.default):this.send(this.default))};h.prototype.pass=function(c){this.value.emit(c)};h.prototype.enable=function(){this.event["link/enable"].emit()};h.prototype.disable=function(){this.event["link/disable"].emit()};h.prototype.disconnect=function(){this.outlet.disconnect(this)};return{VERSION:"v2.0",_:{Patch:b,Node:f,Inlet:m,Outlet:k,Link:h},unit:e,not:function(c){return!c},event:H,events:t,addPatch:function(c){c=new b(c);H["network/add-patch"].emit(c);
return c},render:function(c,a,b){r.emit([c,a,b]);var g=function(g){g.render(c,a,b)};H["network/add-patch"].onValue(g);return function(){H["network/add-patch"].offValue(g)}},nodetype:function(c,a){y[c]=a||{}},channeltype:function(c,a){F[c]=a||{}},nodedescription:function(c,a){J[c]=a},renderer:function(c,a){K[c]=a},styles:B,style:function(c,a,b){B[c]||(B[c]={});B[c][a]=b},noderenderer:function(c,a,b){if(!y[c])throw Error("Node type "+c+" is not registered");A[c]||(A[c]={});A[c][a]=b},channelrenderer:function(c,
a,b){if(!F[c])throw Error("Channel type "+c+" is not registered");G[c]||(G[c]={});G[c][a]=b},"import":{},"export":{},allNodeTypes:y,allNodeDescriptions:J,getStyle:function(c,a){if(!c)throw Error("Unknown style requested: "+c);if(!B[c])throw Error("Style '"+c+"' is not registered");var b=B[c][a];if(!b)throw Error("Style '"+c+"' has no definition for '"+a+"' renderer");return b},short_uid:u}}();"function"===typeof define&&define.amd?(define([],function(){return a}),b.Rpd=a):"object"===typeof module&&
"object"===typeof exports?(module.exports=a,a.Rpd=a):b.Rpd=a})(this);var d3_tiny=function(){function b(a,b,d){for(var f="function"===typeof b?b:function(){return b},m=a.selection,k=0,h=m.length;k<h;k++)d(m[k],f.bind(m[k])(k));return a}function d(a,b,d){b=b||document;selection="string"===typeof a?d?Array.prototype.slice.call(b.querySelectorAll(a),0):[b.querySelector(a)]:a instanceof Node?[a]:Array.isArray(a)?a:[a];this.namespace=1===selection.length&&selection[0]?selection[0].namespaceURI:null;this.selection=selection}d.prototype.empty=function(){return 1===this.selection.length&&
!this.selection[0]||!this.selection.length?!0:!1};d.prototype.attr=function(a,d){return"undefined"===typeof d&&1===this.selection.length?this.selection[0].getAttribute(a):b(this,d,function(b,d){b.setAttributeNS(null,a,d)})};d.prototype.property=function(a,d){return"undefined"===typeof d&&1===this.selection.length?this.selection[0][a]:b(this,d,function(b,d){b[a]=d})};d.prototype.style=function(a,d){"-"===a[0]&&(a=a.slice(1));a=a.replace(/-([a-z])/g,function(a){return a[1].toUpperCase()});return b(this,
d,function(b,d){b.style[a]=d})};d.prototype.text=function(a){return"undefined"===typeof a&&1===this.selection.length?this.selection[0].textContent||this.selection[0].innerText:b(this,a,function(a,b){a.innerText=a.textContent=b})};d.prototype.classed=function(a,d){return"object"===typeof a?b(this,Object.keys(a),function(b,d){for(var e=0,k=d.length;e<k;e++)b.classList.toggle(d[e],a[d[e]])}):b(this,d,function(b,d){b.classList.toggle(a,d)})};d.prototype.select=function(a){return new d(a,this.selection[0])};
d.prototype.selectAll=function(a){return new d(a,this.selection[0],!0)};d.prototype.append=function(a){var e=[];b(this,"string"===typeof a?document.createElementNS(this.namespace,a):a,function(a,b){a.appendChild(b);e.push(b)});return new d(e)};d.prototype.remove=function(){return b(this,function(){return null},function(a){a.parentElement.removeChild(a)})};d.prototype.node=function(a){return this.selection[a||0]};d.prototype.on=function(a,d){return b(this,function(){return d},function(b,d){b.addEventListener(a,
d)})};d.prototype.data=function(a){return a?b(this,a,function(a,b){a.__data__=b}):this.node().__data__};d.prototype.call=function(a){a(this);return this};return{ns:{prefix:{svg:"http://www.w3.org/2000/svg",html:"http://www.w3.org/1999/xhtml"}},select:function(a,b){return new d(a,b)},selectAll:function(a,b){return new d(a,b,!0)}}}();Rpd.Render=function(){function b(a){this.currentPatch=null;this.getPatchByHash=a;var b=this;Kefir.fromEvents(window,"hashchange").map(function(){return window.location.hash?window.location.hash.slice(1):null}).filter(function(a){return!(b.currentPatch&&a===b.currentPatch.id)}).map(b.getPatchByHash).filter(function(a){return null!=a}).onValue(function(a){b.currentPatch&&b.currentPatch.exit();a.enter()})}function d(a){this.nodeRects=[];this.edgePadding=a.edgePadding||{horizontal:30,vertical:20};this.boxPadding=
a.boxPadding||{horizontal:20,vertical:30}}function a(a,b){this.root=a;this.style=b}function e(a,b){this.link=a;this.style=b;this.element=this.styledLink=null}function l(){this.vlinks=[]}function f(a){a.stopPropagation();return a}function m(a){return{x:a.clientX,y:a.clientY}}function k(a,b,d,e){Kefir.fromEvents(a,"click").map(f).map(h(e||!1)).scan(Rpd.not).onValue(function(a){a?b():d()})}var h=Rpd.unit,D=d3_tiny||D;b.prototype.switch=function(a){a&&(this.currentPatch=a,0<=document.title.indexOf("\u2014")?
document.title=document.title.replace(/\u2014.+$/,"\u2014 "+a.name||"[Unnamed]"):document.title+=" \u2014 "+a.name||"[Unnamed]",window.location.hash=a.id)};d.DEFAULT_LIMITS=[1E3,1E3];d.prototype.nextPosition=function(a,b,e){e=e||d.DEFAULT_LIMITS;a=this.nodeRects;var h=this.boxPadding,m=this.edgePadding,f=b.width;b=b.height;var k=a.length?a[a.length-1]:null,k={x:k?k.x:m.horizontal,y:k?k.y+k.height+h.vertical:m.vertical,width:f,height:b};k.y+b+m.vertical>e.height&&(k.x=k.x+f+h.horizontal,k.y=m.vertical);
a.push(k);return{x:k.x,y:k.y}};a.prototype.add=function(a,b){var d=this.root,e=this.style,h=b.start,k=b.end,l=b.drag;Kefir.fromEvents(a.node(),"mousedown").map(m).map(e.getLocalPos).flatMap(function(b){var v=h(),l=b.x-v.x,q=b.y-v.y;b=Kefir.fromEvents(d.node(),"mousemove").map(f).takeUntilBy(Kefir.merge([Kefir.fromEvents(d.node(),"mouseup"),Kefir.fromEvents(a.node(),"mouseup")])).map(m).map(e.getLocalPos).map(function(a){return{x:a.x-l,y:a.y-q}}).toProperty(function(){return v});b.last().onValue(k);
return b}).onValue(l)};e.prototype.construct=function(a){if(this.styledLink)throw Error("VLink is already constructed");this.styledLink=a=this.style.createLink(this.link);this.element=D.select(a.element);return this};e.prototype.rotate=function(a,b,d,e){this.styledLink.rotate(a,b,d,e);return this};e.prototype.rotateI=function(a,b,d){var e=this.style,e=e.getLocalPos(e.getInletPos(d));return this.rotate(a,b,e.x,d.y)};e.prototype.rotateO=function(a,b,d){var e=this.style;a=e.getLocalPos(e.getOutletPos(a));
return this.rotate(a.x,a.y,b,d)};e.prototype.rotateOI=function(a,b){var d=this.style,e=d.getLocalPos(d.getOutletPos(a)),d=d.getLocalPos(d.getInletPos(b));return this.rotate(e.x,e.y,d.x,d.y)};e.prototype.update=function(){if(this.link){var a=this.link;this.rotateOI(a.outlet,a.inlet);return this}};e.prototype.appendTo=function(a){a.append(this.element.node());return this};e.prototype.removeFrom=function(a){this.element.remove();return this};e.prototype.noPointerEvents=function(){this.styledLink.noPointerEvents&&
this.styledLink.noPointerEvents();return this};e.prototype.listenForClicks=function(){var a=this.link;k(this.element.node(),function(){a.enable()},function(){a.disable()});return this};e.prototype.enable=function(){this.element.classed("rpd-disabled",!1)};e.prototype.disable=function(){this.element.classed("rpd-disabled",!0)};e.prototype.get=function(){return this.link};e.prototype.getElement=function(){return this.element.node()};l.prototype.clear=function(){this.vlinks=[]};l.prototype.add=function(a){this.vlinks.push(a);
return a};l.prototype.remove=function(a){this.vlinks=this.vlinks.filter(function(b){return b!==a})};l.prototype.forEach=function(a){this.vlinks.forEach(a)};l.prototype.updateAll=function(){this.forEach(function(a){a.update()})};l.prototype.count=function(){return this.vlinks.length};l.prototype.getLast=function(){return this.count()?this.vlinks[this.vlinks.length-1]:null};var q=function(){var a={};return function(b,d,e){d.classed("rpd-error",!0);a[b]&&clearTimeout(a[b]);a[b]=setTimeout(function(){d.classed("rpd-error",
!1);a[b]=null},e||1)}}(),z=function(){var a={};return function(b,d,e){d.classed("rpd-stale",!1);d.classed("rpd-fresh",!0);a[b]&&clearTimeout(a[b]);a[b]=setTimeout(function(){d.classed("rpd-fresh",!1);d.classed("rpd-stale",!0);a[b]=null},e||1)}}();return{Navigation:b,Placing:d,DragAndDrop:a,VLink:e,VLinks:l,mergeConfig:function(a,b){if(a){var d={};Object.keys(b).forEach(function(a){d[a]=b[a]});Object.keys(a).forEach(function(b){d[b]=a[b]});return d}return b},preventDefault:function(a){a.preventDefault();
return a},stopPropagation:f,extractPos:m,addTarget:function(a){return function(b){return{pos:b,target:a}}},addClickSwitch:k,addValueErrorEffect:q,addValueUpdateEffect:z,subscribeUpdates:function(a,b){b&&Object.keys(b).forEach(function(d){(function(b,d){a.event["node/add-inlet"].filter(function(a){return a.alias===d}).onValue(function(d){a.event["node/is-ready"].onValue(function(){b.default&&d.receive(b.default());if(b.valueOut)b.valueOut.onValue(function(a){d.receive(a)})})})})(b[d],d)})}}}();Rpd.style("quartz","html",function(b){function d(a){a=a.getBoundingClientRect();return{x:a.left,y:a.top}}var a=a||d3_tiny,e,l={},f={};return{edgePadding:{horizontal:30,vertical:20},boxPadding:{horizontal:20,vertical:30},createRoot:function(b,d){return{element:a.select(document.createElement("div")).classed("rpd-patch",!0).node()}},createNode:function(d,e,h){var f=a.select(document.createElement("table")).attr("class","rpd-node");f.append("thead").attr("class","rpd-title").classed("rpd-drag-handle",
!0).call(function(a){a.append("tr").attr("class","rpd-remove-button").append("th").text("x")}).call(function(a){a.append("tr").attr("class","rpd-header").append("th").attr("colspan",3).call(function(a){b.showTypes&&a.append("span").attr("class","rpd-type").text(d.type);a.append("span").attr("class","rpd-name").text(d.name);a.attr("title",h?h+" ("+d.type+")":d.type)})});f.append("tbody").attr("class","rpd-content").call(function(a){a.append("tr").call(function(a){a.append("td").attr("class","rpd-inlets").append("table").append("tbody").append("div").attr("class",
"rpd-inlets-target")}).call(function(a){a.append("td").attr("class","rpd-body").append("table").append("tbody").append("tr").append("td").append("div").attr("class","rpd-process-target")}).call(function(a){a.append("td").attr("class","rpd-outlets").append("table").append("tbody").append("div").attr("class","rpd-outlets-target")})});return{element:f.node(),size:e.size?{width:e.size.width||70,height:e.size.height||30}:{width:70,height:30}}},createInlet:function(d,e){var h=a.select(document.createElement("tr")).attr("class",
"rpd-inlet").call(function(a){a.append("td").attr("class","rpd-connector");a.append("td").attr("class","rpd-value-holder").append("span").attr("class","rpd-value");a.append("td").attr("class","rpd-name").text(d.name);b.showTypes&&a.append("td").attr("class","rpd-type").text(d.type)});l[d.id]=h.select(".rpd-connector");return{element:h.node()}},createOutlet:function(d,e){var h=a.select(document.createElement("tr")).attr("class","rpd-outlet").call(function(a){a.append("td").attr("class","rpd-connector");
a.append("td").attr("class","rpd-value");b.showTypes&&a.append("td").attr("class","rpd-type").text(d.type);a.append("td").attr("class","rpd-name").text(d.name)});f[d.id]=h.select(".rpd-connector");return{element:h.node()}},createLink:function(b){var d=a.select(document.createElement("span")).attr("class","rpd-link").style("position","absolute").style("transform-origin","left top").style("-webkit-transform-origin","left top");return{element:d.node(),rotate:function(a,b,e,f){var m=Math.sqrt((a-e)*(a-
e)+(b-f)*(b-f));e=Math.atan2(f-b,e-a);d.style("left",a+"px").style("top",b+"px").style("width",Math.floor(m)+"px").style("transform","rotateZ("+e+"rad)").style("-webkit-transform","rotateZ("+e+"rad)")}}},getInletPos:function(a){return d(l[a.id].node())},getOutletPos:function(a){return d(f[a.id].node())},getLocalPos:function(a){if(!e)return a;var b=d(e.node());return{x:a.x+b.x,y:a.y+b.y}},onPatchSwitch:function(b,d){e=a.select(d)}}});(function(){function b(b){return function(d,l){var t=E(l,f),r=Rpd.getStyle(t.style,"html")(t);d=m.select(d).classed("rpd-network",!0);var c,x,L;return{"patch/is-ready":function(g){var e=m.select(document.documentElement);c=m.select(r.createRoot(b,d).element).style("height",e.property("clientHeight")+"px");c.classed("rpd-style-"+t.style,!0).classed("rpd-values-"+(t.valuesOnHover?"on-hover":"always-shown"),!0).classed("rpd-show-boxes",t.showBoxes);h.patches[b.id]=c.data({patch:g.patch});h.patchToPlacing[b.id]=
new k.Placing(r);h.patchToLinks[b.id]=new w;x=new v(c,r,t);t.nodeMovingAllowed&&(L=new k.DragAndDrop(c,r));t.renderNodeList&&a(c,z,p);Kefir.fromEvents(window,"resize").map(function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}).onValue(function(a){c.style("height",a+"px")});Kefir.fromEvents(c.node(),"selectstart").onValue(u)},"patch/enter":function(a){q=a.patch;D.switch(a.patch);var c=h.patches[a.patch.id];d.append(c.node());h.patchToLinks[a.patch.id].updateAll();
if(r.onPatchSwitch)r.onPatchSwitch(q,c.node())},"patch/exit":function(a){q=null;c.remove()},"patch/refer":function(a){var c=h.nodes[a.node.id];c.select(".rpd-node").classed("rpd-patch-reference",!0);c.data().processTarget.text("["+(a.target.name||a.target.id)+"]");Kefir.fromEvents(c.data().processTarget.node(),"click").onValue(function(a,c){return function(){a.exit();c.enter()}}(b,a.target))},"patch/add-node":function(a){var c=a.node,b=a.patch,d=a.render,e=m.select(document.createElement("div")).attr("class",
"rpd-node-box"),f=r.createNode(c,d,p[c.type]),k=e.append(f.element);k.classed("rpd-"+c.type.slice(0,c.type.indexOf("/"))+"-toolkit-node",!0).classed("rpd-"+c.type.replace("/","-"),!0);e.style("z-index",0);h.nodes[c.id]=e.data({inletsTarget:k.select(".rpd-inlets-target"),outletsTarget:k.select(".rpd-outlets-target"),processTarget:k.select(".rpd-process-target"),pos:{x:0,y:0}});var l=new w;h.nodeToLinks[c.id]=l;if(t.nodeMovingAllowed){var x=k.select(".rpd-drag-handle");x.empty()||L.add(x,{start:function(){e.classed("rpd-dragging",
!0);e.style("z-index",1);return e.data().pos},drag:function(a){e.style("left",a.x+"px");e.style("top",a.y+"px");l.forEach(function(a){a.element.style("z-index",3);a.update()})},end:function(a){c.move(a.x,a.y);e.classed("rpd-dragging",!1);e.style("z-index",0);l.forEach(function(a){a.element.style("z-index",2)})}})}d.prepare&&d.prepare.bind(c)(h.patches[b.id].node(),h.patches[q.id].node());d.first&&B(c,d.first.bind(c)(k.select(".rpd-process-target").node()));if(d.always)c.event["node/process"].throttle(100).onValue(function(){l.updateAll()});
d=h.patches[q.id];f=f.size;nodePos=h.patchToPlacing[a.patch.id].nextPosition(c,f,{width:d.node().offsetWidth,height:d.node().offsetHeight});k.select(".rpd-body").style("min-width",Math.floor(f.width)+"px");k.select(".rpd-body").style("height",Math.floor(f.height)+"px");c.move(nodePos.x,nodePos.y);a=k.select(".rpd-remove-button");if(!a.empty())Kefir.fromEvents(a.node(),"click").map(C).onValue(function(){b.removeNode(c)});h.patches[b.id].append(e.node())},"patch/remove-node":function(a){a=a.node;var c=
h.nodes[a.id];h.nodeToLinks[a.id].forEach(function(a){a.get().disconnect()});c.remove();if(r.onNodeRemove)r.onNodeRemove(a);h.nodes[a.id]=null;h.nodeToLinks[a.id]=null},"node/move":function(a){var c=h.nodes[a.node.id];a=a.position;c.style("left",Math.floor(a[0])+"px");c.style("top",Math.floor(a[1])+"px");c.data().pos={x:a[0],y:a[1]}},"node/process":function(a){var c=a.node,b=a.render;if(b.always){var d=h.nodes[c.id].data().processTarget.node();b.always.bind(c)(d,a.inlets,a.outlets)}},"node/add-inlet":function(a){var b=
a.inlet;if(!b.hidden){var d=h.nodes[a.node.id].data().inletsTarget;a=a.render;var f=m.select(r.createInlet(b,a).element);f.classed("rpd-"+b.type.replace("/","-"),!0);f.classed({"rpd-stale":!0,"rpd-readonly":b.readonly,"rpd-cold":b.cold});var k=null;!b.readonly&&a.edit&&(k=new e(b,a,c,f.select(".rpd-value-holder"),f.select(".rpd-value"),m.select(document.createElement("div"))),f.select(".rpd-value-holder").append(k.editorElm.node()));h.inlets[b.id]=f.data({connector:f.select(".rpd-connector"),value:f.select(".rpd-value"),
vlinks:new w,editor:k});b.event["inlet/update"].onError(function(){G(b.id,f,t.effectTime)});x.subscribeInlet(b,f.select(".rpd-connector"));d.append(f.node())}},"node/add-outlet":function(a){var c=a.outlet,b=h.nodes[a.node.id].data().outletsTarget;a=m.select(r.createOutlet(c,a.render).element);a.classed("rpd-"+c.type.replace("/","-"),!0);a.classed("rpd-stale",!0);h.outlets[c.id]=a.data({connector:a.select(".rpd-connector"),value:a.select(".rpd-value"),vlinks:new w});x.subscribeOutlet(c,a.select(".rpd-connector"));
b.append(a.node())},"node/remove-inlet":function(a){a=a.inlet;h.inlets[a.id].data().vlinks.forEach(function(a){a.get().disconnect()});h.inlets[a.id].remove();if(r.onInletRemove)r.onInletRemove(a);h.inlets[a.id]=null},"node/remove-outlet":function(a){a=a.outlet;h.outlets[a.id].data().vlinks.forEach(function(a){a.get().disconnect()});h.outlets[a.id].remove();if(r.onOutletRemove)r.onOutletRemove(a);h.outlets[a.id]=null},"inlet/update":function(a){var c=a.inlet;if(!c.hidden){var b=a.render,d=h.inlets[c.id],
e=d.data().value;if(!e.empty()){var f=c.def.show?c.def.show(a.value):a.value;b.show?b.show.bind(c)(e.node(),a.value,f):e.text(f)}J(c.id,d,t.effectTime)}},"outlet/update":function(a){var c=a.outlet,b=a.render,d=h.outlets[c.id],e=d.data().value;if(!e.empty()){var f=c.def.show?c.def.show(a.value):a.value;b.show?b.show.bind(c)(e.node(),a.value,f):e.text(f)}J(c.id,d,t.effectTime)},"outlet/connect":function(a){a=a.link;var d=a.outlet,e=a.inlet,f=h.inlets[e.id],k=h.outlets[d.id].data(),f=f.data();if(!t.inletAcceptsMultipleLinks&&
1===f.vlinks.count())throw Error("Inlet is already connected to a link");f.editor&&f.editor.disable();var l=new I(a,r);l.construct(t.linkWidth).rotateOI(d,e);m.select(l.getElement()).style("z-index",2).classed("rpd-"+e.type.replace("/","-"),!0).classed("rpd-"+d.type.replace("/","-"),!0);h.links[a.id]=l;k.vlinks.add(l);f.vlinks.add(l);h.nodeToLinks[d.node.id].add(l);d.node.id!==e.node.id&&h.nodeToLinks[e.node.id].add(l);h.patchToLinks[b.id].add(l);l.listenForClicks();l.appendTo(c)},"outlet/disconnect":function(a){a=
a.link;var d=h.links[a.id],e=a.outlet,f=a.inlet,k=h.outlets[e.id].data(),l=h.inlets[f.id].data();h.links[a.id]=null;k.vlinks.remove(d);l.vlinks.remove(d);h.nodeToLinks[e.node.id].remove(d);e.node.id!==f.node.id&&h.nodeToLinks[f.node.id].remove(d);h.patchToLinks[b.id].remove(d);d.removeFrom(c)},"link/enable":function(a){var c=h.inlets[a.link.inlet.id].data();c.editor&&c.editor.disable();h.links[a.link.id].enable()},"link/disable":function(a){h.links[a.link.id].disable()}}}}function d(a,b){return Kefir.merge([a.map(l(!0)),
b.map(l(!1))]).toProperty(l(!1))}function a(a,b,d){var e={};Object.keys(b).forEach(function(a){var d=a.split("/"),f=d[0],d=d[1];e[f]||(e[f]={});e[f][d]=b[a]});var f=m.select(document.createElement("dl")).attr("class","rpd-nodelist");Object.keys(e).forEach(function(a){var b=f.append("dd").attr("class","rpd-toolkit-name").text(a);f.append("dt").append("dl").attr("class","rpd-toolkit").data({titleElm:b,nodeTypes:e[a],toolkit:a}).call(function(a){var c=a.data().titleElm;A(c.node(),function(){a.classed("rpd-collapsed",
!0)},function(){a.classed("rpd-collapsed",!1)},!0)}).call(function(a){var c=a.data().toolkit,b=a.data().nodeTypes;Object.keys(b).forEach(function(b){var e=c+"/"+b;b=a.append("dd").attr("class","rpd-node-title").text(b);b.append("span").attr("class","rpd-add-node").text("+ Add").data(e).call(function(a){Kefir.fromEvents(a.node(),"click").map(C).onValue(function(){q.addNode(a.data())})});a.append("dd").attr("class","rpd-node-description").data({titleElm:b}).text(d[e]||"[No Description]").classed("rpd-collapsed",
!0).call(function(a){A(a.data().titleElm.node(),function(){a.classed("rpd-collapsed",!0)},function(){a.classed("rpd-collapsed",!1)})})})})});a.append(f.node());a.append(m.select(document.createElement("span")).attr("class","rpd-collapse-nodelist").text(">>").call(function(a){A(a.node(),function(){a.classed("rpd-collapsed",!0).text("<<");f.classed("rpd-collapsed",!0)},function(){a.classed("rpd-collapsed",!1).text(">>");f.classed("rpd-collapsed",!1)},!0)}).node())}function e(a,b,d,e,f,c){var k=Kefir.emitter(),
m=Kefir.emitter();this.disableEditor=m;this.editorElm=c;this.valueElm=f;c.classed("rpd-value-editor",!0);b.edit.bind(a)(c.node(),a,k).onValue(function(c){a.receive(c)});Kefir.combine([Kefir.merge([Kefir.fromEvents(e.node(),"click").map(C).map(l(!0)),Kefir.fromEvents(d.node(),"click").merge(m).map(l(!1))]).toProperty(l(!1)).skipDuplicates()],[a.event["inlet/update"]]).map(function(a){return{lastValue:a[1],startEditing:a[0],cancelEditing:!a[0]}}).onValue(function(c){if(c.startEditing){var b=h.inlets[a.id].data();
b.link&&b.link.disable();k.emit(c.lastValue);e.classed("rpd-editor-enabled",!0)}else c.cancelEditing&&(f.classed("rpd-edited",!0),e.classed("rpd-editor-enabled",!1))});e.classed("rpd-editor-disabled",!0)}var l=Rpd.unit,f={style:"quartz",valuesOnHover:!1,showTypes:!1,showBoxes:!1,nodeMovingAllowed:!0,renderNodeList:!0,nodeListCollapsed:!0,inletAcceptsMultipleLinks:!1,effectTime:1E3},m=m||d3_tiny,k=Rpd.Render,h={patches:{},nodes:{},inlets:{},outlets:{},links:{},patchToPlacing:{},patchToLinks:{},nodeToLinks:{}},
D=new k.Navigation(function(a){return function(b){return a.patches[b].data().patch}}(h)),q,z=Rpd.allNodeTypes,p=Rpd.allNodeDescriptions,v=function(){function a(c){return h.inlets[c.id].data().vlinks}function b(c){return function(){return 0<a(c).count()}}function e(a){1===a.count()&&(a=a.getLast().link,a.outlet.disconnect(a))}function f(a,b){a.forEach(function(a){a.link.outlet.id===b.id&&b.disconnect(a.link)})}function k(a,b,e){this.root=a;this.style=b;this.config=e;this.rootClicks=Kefir.fromEvents(this.root.node(),
"click");this.inletClicks=Kefir.pool();this.outletClicks=Kefir.pool();this.startLink=Kefir.emitter();this.finishLink=Kefir.emitter();this.doingLink=d(this.startLink,this.finishLink)}k.prototype.subscribeOutlet=function(c,b){var h=this.root,g=this.style,k=this.config,r=this.rootClicks,p=this.outletClicks,q=this.inletClicks,v=this.startLink,w=this.finishLink,u=this.doingLink;p.plug(Kefir.fromEvents(b.node(),"click").map(y).map(F(c)));Kefir.fromEvents(b.node(),"click").map(C).filterBy(d(p,u)).map(y).onValue(function(b){v.emit();
var d=(new I(null,g)).construct(k.linkWidth).rotateO(c,b.x,b.y).noPointerEvents().appendTo(h);m.select(d.getElement()).style("z-index",2).classed("rpd-"+c.type.replace("/","-"),!0);Kefir.fromEvents(h.node(),"mousemove").takeUntilBy(Kefir.merge([q,p.map(l(!1)),r.map(l(!1))]).take(1).onValue(function(b){if(b){b=b.target;var d=a(b);k.inletAcceptsMultipleLinks?f(d,c):e(d);c.connect(b)}})).map(y).onValue(function(a){d.rotateO(c,a.x,a.y)}).onEnd(function(){d.removeFrom(h);w.emit()})})};k.prototype.subscribeInlet=
function(c,h){var k=this.root,g=this.style,n=this.config,p=this.rootClicks,r=this.outletClicks,q=this.inletClicks,v=this.startLink,w=this.finishLink,u=this.doingLink;q.plug(Kefir.fromEvents(h.node(),"click").map(y).map(F(c)));Kefir.fromEvents(h.node(),"click").map(C).filterBy(d(q,u)).filter(b(c)).onValue(function(b){var d=a(c).getLast().link,h=d.outlet;h.disconnect(d);v.emit();var u=(new I(null,g)).construct(n.linkWidth).rotateO(h,b.x,b.y).noPointerEvents().appendTo(k);m.select(u.getElement()).style("z-index",
2).classed("rpd-"+c.type.replace("/","-"),!0).classed("rpd-"+h.type.replace("/","-"),!0);Kefir.fromEvents(k.node(),"mousemove").takeUntilBy(Kefir.merge([q,r.map(l(!1)),p.map(l(!1))]).take(1).onValue(function(c){if(c){c=c.target;var b=a(c);n.inletAcceptsMultipleLinks?f(b,h):e(b);h.connect(c)}})).map(y).map(g.getLocalPos).onValue(function(a){u.rotateO(h,a.x,a.y)}).onEnd(function(){u.removeFrom(k);w.emit()})})};return k}();e.prototype.disable=function(){this.valueElm.classed("rpd-edited",!1);this.disableEditor.emit()};
var I=k.VLink,w=k.VLinks,E=k.mergeConfig,u=k.preventDefault,C=k.stopPropagation,y=k.extractPos,F=k.addTarget,A=k.addClickSwitch,G=k.addValueErrorEffect,J=k.addValueUpdateEffect,B=k.subscribeUpdates;Rpd.HtmlRenderer=b;Rpd.renderer("html",b)})();Rpd.nodedescription("core/custom","May have any number of inlets and outlets, a target for extension.");Rpd.nodetype("core/custom",{name:"Custom"});Rpd.channeltype("core/number",{default:0,readonly:!1,accept:function(b){if(Infinity===b)return!0;b=parseFloat(b);return!isNaN(b)&&isFinite(b)},adapt:function(b){return parseFloat(b)}});
Rpd.channeltype("core/time",{default:1E3,accept:function(b){b=parseFloat(b);return!isNaN(b)&&isFinite(b)},adapt:function(b){return parseFloat(b)},show:function(b){return Math.floor(b/10)/100+"s"}});Rpd.nodetype("core/number",{name:"number",inlets:{"user-value":{type:"core/number",default:0,hidden:!0}},outlets:{out:{type:"core/number"}},process:function(b){return{out:b["user-value"]}}});
Rpd.nodetype("core/random",function(){var b=0;return{name:"random",inlets:{min:{type:"core/number",default:0},max:{type:"core/number",default:100},period:{type:"core/time",default:1E3}},outlets:{out:{type:"core/number"}},process:function(d){if(d.hasOwnProperty("period"))return b++,{out:Kefir.withInterval(d.period,function(a){a.emit(Math.floor(d.min+Math.random()*(d.max-d.min)))}).takeWhile(function(a){return function(){return a===b}}(b))}}}});
Rpd.nodetype("core/bounded-number",{name:"bounded number",inlets:{min:{type:"core/number",default:0},max:{type:"core/number",default:Infinity},spinner:{type:"core/number",default:0,hidden:!0}},outlets:{out:{type:"core/number"}},process:function(b){if(b.hasOwnProperty("spinner"))return{out:b.spinner}}});Rpd.channeltype("core/any",{});Rpd.channeltype("core/boolean",{default:!1,readonly:!1,adapt:function(b){return b?!0:!1}});(function(){function b(a){return{x:a.clientX,y:a.clientY}}function d(a,d,l){this.element=a;this.min=d||0;this.max=isNaN(l)?Infinity:l;this.value=this.min;var f=this;this.incoming=Kefir.emitter();Kefir.fromEvents(a,"mousedown").map(b).flatMap(function(a){var d=f.value;return Kefir.fromEvents(document.body,"mousemove").map(b).takeUntilBy(Kefir.fromEvents(document.body,"mouseup")).map(function(b){return d+(b.x-a.x)}).onValue(function(a){f.incoming.emit(a)})}).onEnd(function(){});this.changes=this.incoming.map(function(a){return f.setValue(a)})}
Rpd.noderenderer("core/number","html",{first:function(a){var b=document.createElement("input");b.style.display="block";b.type="number";b.min=0;b.max=1E3;a.appendChild(b);return{"user-value":{default:function(){return b.value=0},valueOut:Kefir.fromEvents(b,"change").map(function(){return b.value})}}}});Rpd.channelrenderer("core/boolean","html",{edit:function(a,b,d){var f=document.createElement("input");f.type="checkbox";d.onValue(function(a){f.checked=a?!0:!1});a.appendChild(f);return Kefir.fromEvents(f,
"change").map(function(){return f.checked}).toProperty(function(){return!1})}});Rpd.channelrenderer("core/number","html",{edit:function(a,b,d){var f=document.createElement("input");f.type="number";d.onValue(function(a){f.value=a});a.appendChild(f);return Kefir.fromEvents(f,"change").map(function(){return f.value})}});Rpd.noderenderer("core/bounded-number","html",function(){var a,b;return{first:function(l){a=document.createElement("span");a.classList.add("rpd-core-spinner");b=new d(a);var f=b.getChangesStream();
l.appendChild(a);return{spinner:{valueOut:f.map(function(a){return parseFloat(a)})}}},always:function(d,f){b.updateBounds(f.min,f.max);a.innerText=a.textContent=b.setValue(f.spinner)}}});d.prototype.setValue=function(a){this.value=a;return this.checkValue()};d.prototype.checkValue=function(){if(isNaN(this.value)||this.value<this.min)this.value=this.min,this.incoming.emit(this.min);this.value>this.max&&(this.value=this.max,this.incoming.emit(this.max));return this.value};d.prototype.updateBounds=function(a,
b){this.min=a||0;this.max=isNaN(b)?Infinity:b;return this.checkValue()};d.prototype.getChangesStream=function(){return this.changes}})();Rpd.channeltype("timbre/t-num",{allow:["core/number"],adapt:function(b){return isNaN(b)?b:T(b)},accept:function(b){return!isNaN(b)||b&&b.value},show:function(b){return b?b.value:"?"}});Rpd.channeltype("timbre/t-wave",{});Rpd.channeltype("timbre/t-obj",{show:function(b){return b?"[Some]":"[None]"}});Rpd.nodedescription("timbre/osc","Oscillator. That's it.");
Rpd.nodetype("timbre/osc",{name:"osc",description:"Oscillator. That's it.",inlets:{wave:{type:"timbre/t-wave",default:"sin"},freq:{type:"timbre/t-num",default:T(440)}},outlets:{sound:{type:"timbre/t-obj"}},process:function(b){return b.wave&&b.freq?{sound:T("osc",{wave:b.wave,freq:b.freq})}:null}});Rpd.nodedescription("timbre/wave","Choose a wave type, like sine or saw.");
Rpd.nodetype("timbre/wave",{name:"wave",inlets:{wave:{type:"timbre/t-wave",default:"sin",hidden:!0}},outlets:{wave:{type:"timbre/t-wave"}},process:function(b){return{wave:b.wave}}});Rpd.nodedescription("timbre/plot","Draw your sound wave on a Canvas.");Rpd.nodetype("timbre/plot",{name:"plot",inlets:{sound:{type:"timbre/t-obj",default:null}},process:function(){}});Rpd.nodedescription("timbre/play","Play a given sound. Control your volume safely.");
Rpd.nodetype("timbre/play",function(){var b;return{name:"play",inlets:{sound:{type:"timbre/t-obj",default:null}},tune:function(b){return b.throttle(50)},process:function(d,a){a.sound&&a.sound.pause();d.sound&&(b=d.sound,d.sound.play())},handle:{"node/turn-off":function(){b&&b.pause()}}}});(function(){function b(b,a){var e=document.createElement("option");e.value=b;e.innerText=e.textContent=b;a&&(e.selected="selected");return e}Rpd.noderenderer("timbre/osc","html",{always:function(b,a){b.innerText=b.textContent=a.wave+"/"+a.freq}});Rpd.noderenderer("timbre/wave","html",{first:function(d){var a=document.createElement("select");a.appendChild(b("sin"));a.appendChild(b("saw"));a.appendChild(b("tri"));a.appendChild(b("pulse"));a.appendChild(b("fami"));d.appendChild(a);return{wave:{default:function(){return a.value=
"sin"},valueOut:Kefir.fromEvents(a,"change").map(function(){return a.options[a.selectedIndex].value})}}}});Rpd.noderenderer("timbre/plot","html",function(){var b;return{first:function(a){b=document.createElement("canvas");b.width=100;b.height=100;a.appendChild(b)},always:function(a,e){e.sound&&e.sound.plot({target:b})}}})})();
