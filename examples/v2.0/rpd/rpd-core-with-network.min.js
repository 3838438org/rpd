/**
 * rpd - RPD is a minimal framework for building Node-Based User Interfaces, powered by Reactive Programming
 * Built at Sat, 12 Dec 2015 09:09:10 GMT
 *
 * @version v0.2.0
 * @link http://shamansir.github.io/rpd
 * @author Ulric Wilfred <shaman.sir@gmail.com>
 * @license MIT
 * 
 * Selected Renderers: svg
 * Selected Styles: quartz
 * Selected Toolkits: core, demo
 * Selected I/O Modules: json
 * d3.js or d3_tiny.js: d3_tiny.js
 *
 * User Styles: [None]
 * User Toolkits: [None]
 *
 * Command: gulp --root . --renderer svg --style quartz --toolkit core --toolkit demo --io json --target-name rpd-core-with-network --compilation simple
 */
(function(g){var e=g.Kefir;"undefined"===typeof e&&"undefined"!==typeof require&&(e=require("../vendor/kefir.min.js"));if(!e)throw Error("Kefir.js (https://github.com/rpominov/kefir) is required for Rpd to work");var d=function(){function a(b){return function(){return b}}function h(b){this.id=x();this.name=b;var f=this;b={"patch/is-ready":[],"patch/enter":[],"patch/exit":[],"patch/set-inputs":["inputs"],"patch/set-outputs":["outputs"],"patch/project":["node","target"],"patch/refer":["node","target"],
"patch/add-node":["node"],"patch/remove-node":["node"]};this.event=B(b);this.events=D(b,this.event,"patch",this);this.renderQueue=e.emitter();b=e.combine([this.events],[this.renderQueue.scan(function(b,a){var c=a.alias,p=a.target,h=a.config,d=b[c];d||(d={},d.produce=J[c](f),d.handlers=[],b[c]=d);if(d.produce){var e=d.produce(p,h);e&&d.handlers.push("function"===typeof e?e:function(f){if(e[f.type])e[f.type](f)})}return b},{})]);b=b.bufferBy(this.renderQueue).take(1).flatten().concat(b);b.onValue(function(f){var b=
f[0];f=f[1];for(var a=Object.keys(f),c,p=0,h=a.length;p<h;p++){c=f[a[p]];c=c.handlers;for(var d=0,e=c.length;d<e;d++)c[d](G(l(b),a[p]))}});this.projections=e.emitter();e.combine([this.projections],[this.event["patch/set-inputs"],this.event["patch/set-outputs"]]).onValue(function(b){var a=b[0],c=b[1];b=b[2];for(var p,d=0;d<c.length;d++)p=a.addInlet(c[d].type,c[d].name),p.event["inlet/update"].onValue(function(f){return function(b){f.receive(b)}}(c[d]));for(d=0;d<b.length;d++)c=a.addOutlet(b[d].type,
b[d].name),b[d].event["outlet/update"].onValue(function(f){return function(b){f.send(b)}}(c));f.event["patch/project"].emit({node:a,target:a.patch});a.patch.event["patch/refer"].emit({node:a,target:f})});this.nodesToRemove=e.emitter();this.event["patch/is-ready"].emit()}function g(b,f,F,a){this.type=b||"core/empty";this.id=x();var c=C(n[this.type],this);c||w("Node type "+this.type+" is not registered!");this.def=c;this.name=F||c.name||b;this.patch=f;this.render=p(y[this.type],this);b={"node/turn-on":[],
"node/is-ready":[],"node/process":["inlets","outlets"],"node/turn-off":[],"node/add-inlet":["inlet"],"node/remove-inlet":["inlet"],"node/add-outlet":["outlet"],"node/remove-outlet":["outlet"],"node/move":["position"]};this.event=B(b);this.events=D(b,this.event,"node",this);a&&a(this);var d=this;if(this.def.handle)this.events.onValue(function(f){if(d.def.handle[f.type])d.def.handle[f.type](f)});if(this.def.process){var h=this.def.process;a=e.combine([this.event["node/add-inlet"].flatMap(function(f){var b=
f.event["inlet/update"].map(function(b){return{inlet:f,value:b}});d.def.tune&&(b=d.def.tune(b));return b})],[this.event["node/add-outlet"].scan(function(f,b){f[b.alias]=b;return f},{})]);a=a.bufferBy(this.event["node/is-ready"]).take(1).flatten().concat(a);a=a.scan(function(f,b){var a=b[0].inlet,F=a.alias;f.inlets.prev[F]=f.inlets.cur[F];f.inlets.cur[F]=b[0].value;f.outlets=b[1];f.source=a;return f},{inlets:{prev:{},cur:{}},outlets:{}}).changes();a=a.filter(function(f){return!f.source.cold});a.onValue(function(f){var b=
h.bind(d)(f.inlets.cur,f.inlets.prev);d.event["node/process"].emit({inlets:f.inlets.cur,outlets:b});f=f.outlets;for(var a in b)f[a]&&(b[a]instanceof e.Stream?f[a].stream(b[a]):f[a].send(b[a]))})}if(this.def.inlets){this.inlets={};for(var l in this.def.inlets)a=this.def.inlets[l],a=this.addInlet(a.type,l,a.name,a.default,a.hidden,a.readonly,a.cold),this.inlets[l]=a}if(this.def.outlets)for(l in this.outlets={},this.def.outlets)a=this.def.outlets[l],a=this.addOutlet(a.type,l,a.name,a.default),this.outlets[l]=
a;this.def.prepare&&this.def.prepare(this.inlets,this.outlets);this.event["node/is-ready"].emit()}function m(b,f,a,c,d,h,g,l){this.type=b||"core/any";this.id=x();var r=C(A[this.type],this);r||w("Channel type "+this.type+" is not registered!");this.def=r;(this.alias=a||r.alias||c)||w("Inlet should have either alias or name");this.name=c||r.name||this.alias||b;this.node=f;this.hidden=h||!1;this.readonly=q(g||r.readonly)?g||r.readonly:!0;this.cold=l||!1;this.default=q(d)?d:r.default;this.value=e.pool();
this.render=p(E[this.type],this);b={"inlet/update":["value"]};this.event=B(b);var t=this.event["inlet/update"];f=t.merge(this.value);r.tune&&(f=r.tune(f));r.accept&&(f=f.flatten(function(f){if(r.accept(f))return[f];t.error();return[]}));r.adapt&&(f=f.map(r.adapt));this.event["inlet/update"]=f.onValue(function(){});this.events=D(b,this.event,"inlet",this)}function k(b,f,a,c,d){this.type=b||"core/any";this.id=x();var h=C(A[this.type],this);h||w("Channel type "+this.type+" is not registered!");this.def=
h;(this.alias=a||h.alias||c)||w("Outlet should have either alias or name");this.name=c||this.alias||h.name||b;this.node=f;this.default=q(d)?d:h.default;this.value=e.pool();this.render=p(E[this.type],this);b={"outlet/update":["value"],"outlet/connect":["link","inlet"],"outlet/disconnect":["link"]};this.event=B(b);f=this.event["outlet/update"].merge(this.value);this.event["outlet/update"]=f.onValue(function(f){});this.events=D(b,this.event,"outlet",this);var r=this;e.combine([this.event["outlet/connect"]],
[this.event["outlet/update"]]).onValue(function(f){r.value.plug(e.constant(f[1]))})}function c(b,f,F){this.id=x();this.name=F||"";this.outlet=b;this.inlet=f;this.value=e.emitter();var c=this;this.receiver=b.node.id!==f.node.id?function(f){c.pass(f)}:function(f){setTimeout(function(){c.pass(f)},0)};b={"link/enable":[],"link/disable":[],"link/pass":["value"]};this.event=B(b);F=this.event["link/pass"].merge(this.value);this.event["link/pass"]=F.onValue(function(f){});this.events=D(b,this.event,"link",
this);this.enabled=e.merge([this.event["link/disable"].map(a(!1)),this.event["link/enable"].map(a(!0))]).toProperty(a(!0));this.event["link/pass"].filterBy(this.enabled).onValue(function(b){f.receive(b)});e.combine([this.event["link/enable"]],[this.event["link/pass"]]).onValue(function(f){c.pass(f[1])})}function l(b){for(var f={},a=Object.keys(b),c=0,d=a.length;c<d;c++)f[a[c]]=b[a[c]];return f}function q(b){return"undefined"!==typeof b}function C(b,f){return b?"function"===typeof b?b(f):b:null}function p(b,
f){if(!b)return{};var a={},c;for(c in b)a[c]=C(b[c],f);return a}function B(b){var f={};b=Object.keys(b);for(var a=0,c;a<b.length;a++)c=b[a],f[c]=e.emitter();return f}function r(b,f){if(0===f.length)return function(){return{type:b}};if(1===f.length)return function(a){var c={};c.type=b;c[f[0]]=a;return c};if(1<f.length)return function(f){f=l(f);f.type=b;return f}}function D(b,f,a,c){for(var d=e.pool(),p=Object.keys(b),h=0;h<p.length;h++)d.plug(f[p[h]].map(r(p[h],b[p[h]])).map(function(f){f[a]=c;return f}));
return d}function w(b,f){throw f||Error(b);}function x(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}function G(b,f){var a=b.type;if("patch/add-node"===a||"node/process"===a)b.render=b.node.render[f]||{};else if("node/add-inlet"===a||"inlet/update"===a)b.render=b.inlet.render[f]||{};else if("node/add-outlet"===a||"outlet/update"===a)b.render=b.outlet.render[f]||{};return b}(function(){e.emitter=function(){var b,f=e.stream(function(f){b=f;return function(){b=void 0}});f.emit=
function(f){b&&b.emit(f);return this};f.error=function(f){b&&b.error(f);return this};f.end=function(){b&&b.end();return this};f.emitEvent=function(f){b&&b.emitEvent(f);return this};return f.setName("emitter")}})();var n={},A={},y={},E={},I={},z={},J={},K={"network/add-patch":["patch"]},v=B(K),t=D(K,v,"network",d);v["network/add-patch"].onValue(function(b){t.plug(b.events)});var H=e.emitter();h.prototype.render=function(b,f,a){b=Array.isArray(b)?b:[b];f=Array.isArray(f)?f:[f];for(var c=0,d=b.length,
p;c<d;c++)for(var h=0,e=f.length,r;h<e;h++){p=b[c];r=f[h];if(!J[p])throw Error("Renderer "+p+" is not registered");this.renderQueue.emit({alias:p,target:r,config:a})}return this};h.prototype.addNode=function(b,f){var a=this;return new g(b,this,f,function(f){a.events.plug(f.events);a.event["patch/add-node"].emit(f);f.turnOn()})};h.prototype.removeNode=function(b){b.turnOff();this.event["patch/remove-node"].emit(b);this.events.unplug(b.events)};h.prototype.enter=function(){this.event["patch/enter"].emit();
return this};h.prototype.exit=function(){this.event["patch/exit"].emit();return this};h.prototype.inputs=function(b){this.event["patch/set-inputs"].emit(b)};h.prototype.outputs=function(b){this.event["patch/set-outputs"].emit(b)};h.prototype.project=function(b){this.projections.emit(b)};g.prototype.turnOn=function(){this.event["node/turn-on"].emit()};g.prototype.turnOff=function(){this.event["node/turn-off"].emit()};g.prototype.addInlet=function(b,f,a,c,d,p,h){b=new m(b,this,f,a,c,d,p,h);this.events.plug(b.events);
this.event["node/add-inlet"].emit(b);b.toDefault();return b};g.prototype.addOutlet=function(b,f,a,c){b=new k(b,this,f,a,c);this.events.plug(b.events);this.event["node/add-outlet"].emit(b);b.toDefault();return b};g.prototype.removeInlet=function(b){this.event["node/remove-inlet"].emit(b);this.events.unplug(b.events)};g.prototype.removeOutlet=function(b){this.event["node/remove-outlet"].emit(b);this.events.unplug(b.events)};g.prototype.move=function(b,f){this.event["node/move"].emit([b,f]);return this};
m.prototype.receive=function(b){this.value.plug(e.constant(b))};m.prototype.stream=function(b){this.value.plug(b)};m.prototype.toDefault=function(){q(this.default)&&(this.default instanceof e.Stream?this.stream(this.default):this.receive(this.default))};m.prototype.allows=function(b){if(b.type===this.type)return!0;if(!this.def.allow&&b.type!==this.type)return!1;if(this.def.allow){var f=!1;this.def.allow.forEach(function(a){b.type===a&&(f=!0)});return f}return!0};k.prototype.connect=function(b){if(!b.allows(this))throw Error("Outlet of type "+
this.type+" is not allowed to connect to inlet of type "+b.type);var f=new c(this,b);this.events.plug(f.events);this.value.onValue(f.receiver);this.event["outlet/connect"].emit({link:f,inlet:b});return f};k.prototype.disconnect=function(b){this.event["outlet/disconnect"].emit(b);this.value.offValue(b.receiver);this.events.unplug(b.events);return this};k.prototype.send=function(b){this.value.plug(e.constant(b))};k.prototype.stream=function(b){this.value.plug(b)};k.prototype.toDefault=function(){q(this.default)&&
(this.default instanceof e.Stream?this.stream(this.default):this.send(this.default))};c.prototype.pass=function(b){this.value.emit(b)};c.prototype.enable=function(){this.event["link/enable"].emit()};c.prototype.disable=function(){this.event["link/disable"].emit()};c.prototype.disconnect=function(){this.outlet.disconnect(this)};return{VERSION:"v2.0",_:{Patch:h,Node:g,Inlet:m,Outlet:k,Link:c},unit:a,not:function(b){return!b},event:v,events:t,addPatch:function(b){b=new h(b);v["network/add-patch"].emit(b);
return b},render:function(b,f,a){H.emit([b,f,a]);var c=function(c){c.render(b,f,a)};v["network/add-patch"].onValue(c);return function(){v["network/add-patch"].offValue(c)}},nodetype:function(b,f){n[b]=f||{}},channeltype:function(b,f){A[b]=f||{}},nodedescription:function(b,f){I[b]=f},renderer:function(b,f){J[b]=f},styles:z,style:function(b,f,a){z[b]||(z[b]={});z[b][f]=a},noderenderer:function(b,f,a){if(!n[b])throw Error("Node type "+b+" is not registered");y[b]||(y[b]={});y[b][f]=a},channelrenderer:function(b,
f,a){if(!A[b])throw Error("Channel type "+b+" is not registered");E[b]||(E[b]={});E[b][f]=a},"import":{},"export":{},allNodeTypes:n,allNodeDescriptions:I,getStyle:function(b,f){if(!b)throw Error("Unknown style requested: "+b);if(!z[b])throw Error("Style '"+b+"' is not registered");var a=z[b][f];if(!a)throw Error("Style '"+b+"' has no definition for '"+f+"' renderer");return a},short_uid:x}}();"function"===typeof define&&define.amd?(define([],function(){return d}),g.Rpd=d):"object"===typeof module&&
"object"===typeof exports?(module.exports=d,d.Rpd=d):g.Rpd=d})(this);var d3_tiny=function(){function g(d,a,h){for(var e="function"===typeof a?a:function(){return a},g=d.selection,k=0,c=g.length;k<c;k++)h(g[k],e.bind(g[k])(k));return d}function e(d,a,h){a=a||document;selection="string"===typeof d?h?Array.prototype.slice.call(a.querySelectorAll(d),0):[a.querySelector(d)]:d instanceof Node?[d]:Array.isArray(d)?d:[d];this.namespace=1===selection.length&&selection[0]?selection[0].namespaceURI:null;this.selection=selection}e.prototype.empty=function(){return 1===this.selection.length&&
!this.selection[0]||!this.selection.length?!0:!1};e.prototype.attr=function(d,a){return"undefined"===typeof a&&1===this.selection.length?this.selection[0].getAttribute(d):g(this,a,function(a,e){a.setAttributeNS(null,d,e)})};e.prototype.property=function(d,a){return"undefined"===typeof a&&1===this.selection.length?this.selection[0][d]:g(this,a,function(a,e){a[d]=e})};e.prototype.style=function(d,a){"-"===d[0]&&(d=d.slice(1));d=d.replace(/-([a-z])/g,function(a){return a[1].toUpperCase()});return g(this,
a,function(a,e){a.style[d]=e})};e.prototype.text=function(d){return"undefined"===typeof d&&1===this.selection.length?this.selection[0].textContent||this.selection[0].innerText:g(this,d,function(a,d){a.innerText=a.textContent=d})};e.prototype.classed=function(d,a){return"object"===typeof d?g(this,Object.keys(d),function(a,e){for(var g=0,k=e.length;g<k;g++)a.classList.toggle(e[g],d[e[g]])}):g(this,a,function(a,e){a.classList.toggle(d,e)})};e.prototype.select=function(d){return new e(d,this.selection[0])};
e.prototype.selectAll=function(d){return new e(d,this.selection[0],!0)};e.prototype.append=function(d){var a=[];g(this,"string"===typeof d?document.createElementNS(this.namespace,d):d,function(d,e){d.appendChild(e);a.push(e)});return new e(a)};e.prototype.remove=function(){return g(this,function(){return null},function(d){d.parentElement.removeChild(d)})};e.prototype.node=function(d){return this.selection[d||0]};e.prototype.on=function(d,a){return g(this,function(){return a},function(a,e){a.addEventListener(d,
e)})};e.prototype.data=function(d){return d?g(this,d,function(a,d){a.__data__=d}):this.node().__data__};e.prototype.call=function(d){d(this);return this};return{ns:{prefix:{svg:"http://www.w3.org/2000/svg",html:"http://www.w3.org/1999/xhtml"}},select:function(d,a){return new e(d,a)},selectAll:function(d,a){return new e(d,a,!0)}}}();Rpd.Render=function(){function g(a){this.currentPatch=null;this.getPatchByHash=a;var c=this;Kefir.fromEvents(window,"hashchange").map(function(){return window.location.hash?window.location.hash.slice(1):null}).filter(function(a){return!(c.currentPatch&&a===c.currentPatch.id)}).map(c.getPatchByHash).filter(function(a){return null!=a}).onValue(function(a){c.currentPatch&&c.currentPatch.exit();a.enter()})}function e(a){this.nodeRects=[];this.edgePadding=a.edgePadding||{horizontal:30,vertical:20};this.boxPadding=
a.boxPadding||{horizontal:20,vertical:30}}function d(a,c){this.root=a;this.style=c}function a(a,c){this.link=a;this.style=c;this.element=this.styledLink=null}function h(){this.vlinks=[]}function u(a){a.stopPropagation();return a}function m(a){return{x:a.clientX,y:a.clientY}}function k(a,d,e,h){Kefir.fromEvents(a,"click").map(u).map(c(h||!1)).scan(Rpd.not).onValue(function(a){a?d():e()})}var c=Rpd.unit,l=d3_tiny||l;g.prototype.switch=function(a){a&&(this.currentPatch=a,0<=document.title.indexOf("\u2014")?
document.title=document.title.replace(/\u2014.+$/,"\u2014 "+a.name||"[Unnamed]"):document.title+=" \u2014 "+a.name||"[Unnamed]",window.location.hash=a.id)};e.DEFAULT_LIMITS=[1E3,1E3];e.prototype.nextPosition=function(a,c,d){d=d||e.DEFAULT_LIMITS;a=this.nodeRects;var h=this.boxPadding,g=this.edgePadding,l=c.width;c=c.height;var q=a.length?a[a.length-1]:null,q={x:q?q.x:g.horizontal,y:q?q.y+q.height+h.vertical:g.vertical,width:l,height:c};q.y+c+g.vertical>d.height&&(q.x=q.x+l+h.horizontal,q.y=g.vertical);
a.push(q);return{x:q.x,y:q.y}};d.prototype.add=function(a,c){var d=this.root,e=this.style,h=c.start,g=c.end,l=c.drag;Kefir.fromEvents(a.node(),"mousedown").map(m).map(e.getLocalPos).flatMap(function(c){var l=h(),q=c.x-l.x,B=c.y-l.y;c=Kefir.fromEvents(d.node(),"mousemove").map(u).takeUntilBy(Kefir.merge([Kefir.fromEvents(d.node(),"mouseup"),Kefir.fromEvents(a.node(),"mouseup")])).map(m).map(e.getLocalPos).map(function(a){return{x:a.x-q,y:a.y-B}}).toProperty(function(){return l});c.last().onValue(g);
return c}).onValue(l)};a.prototype.construct=function(a){if(this.styledLink)throw Error("VLink is already constructed");this.styledLink=a=this.style.createLink(this.link);this.element=l.select(a.element);return this};a.prototype.rotate=function(a,c,d,e){this.styledLink.rotate(a,c,d,e);return this};a.prototype.rotateI=function(a,c,d){var e=this.style,e=e.getLocalPos(e.getInletPos(d));return this.rotate(a,c,e.x,d.y)};a.prototype.rotateO=function(a,c,d){var e=this.style;a=e.getLocalPos(e.getOutletPos(a));
return this.rotate(a.x,a.y,c,d)};a.prototype.rotateOI=function(a,c){var d=this.style,e=d.getLocalPos(d.getOutletPos(a)),d=d.getLocalPos(d.getInletPos(c));return this.rotate(e.x,e.y,d.x,d.y)};a.prototype.update=function(){if(this.link){var a=this.link;this.rotateOI(a.outlet,a.inlet);return this}};a.prototype.appendTo=function(a){a.append(this.element.node());return this};a.prototype.removeFrom=function(a){this.element.remove();return this};a.prototype.noPointerEvents=function(){this.styledLink.noPointerEvents&&
this.styledLink.noPointerEvents();return this};a.prototype.listenForClicks=function(){var a=this.link;k(this.element.node(),function(){a.enable()},function(){a.disable()});return this};a.prototype.enable=function(){this.element.classed("rpd-disabled",!1)};a.prototype.disable=function(){this.element.classed("rpd-disabled",!0)};a.prototype.get=function(){return this.link};a.prototype.getElement=function(){return this.element.node()};h.prototype.clear=function(){this.vlinks=[]};h.prototype.add=function(a){this.vlinks.push(a);
return a};h.prototype.remove=function(a){this.vlinks=this.vlinks.filter(function(c){return c!==a})};h.prototype.forEach=function(a){this.vlinks.forEach(a)};h.prototype.updateAll=function(){this.forEach(function(a){a.update()})};h.prototype.count=function(){return this.vlinks.length};h.prototype.getLast=function(){return this.count()?this.vlinks[this.vlinks.length-1]:null};var q=function(){var a={};return function(c,d,e){d.classed("rpd-error",!0);a[c]&&clearTimeout(a[c]);a[c]=setTimeout(function(){d.classed("rpd-error",
!1);a[c]=null},e||1)}}(),C=function(){var a={};return function(c,d,e){d.classed("rpd-stale",!1);d.classed("rpd-fresh",!0);a[c]&&clearTimeout(a[c]);a[c]=setTimeout(function(){d.classed("rpd-fresh",!1);d.classed("rpd-stale",!0);a[c]=null},e||1)}}();return{Navigation:g,Placing:e,DragAndDrop:d,VLink:a,VLinks:h,mergeConfig:function(a,c){if(a){var d={};Object.keys(c).forEach(function(a){d[a]=c[a]});Object.keys(a).forEach(function(c){d[c]=a[c]});return d}return c},preventDefault:function(a){a.preventDefault();
return a},stopPropagation:u,extractPos:m,addTarget:function(a){return function(c){return{pos:c,target:a}}},addClickSwitch:k,addValueErrorEffect:q,addValueUpdateEffect:C,subscribeUpdates:function(a,c){c&&Object.keys(c).forEach(function(d){(function(c,d){a.event["node/add-inlet"].filter(function(a){return a.alias===d}).onValue(function(d){a.event["node/is-ready"].onValue(function(){c.default&&d.receive(c.default());if(c.valueOut)c.valueOut.onValue(function(a){d.receive(a)})})})})(c[d],d)})}}}();Rpd.style("quartz","svg",function(g){function e(a){return document.createElementNS(h.ns.prefix.svg,a)}function d(a,c,d,e,h,g,k,m){return"M"+a+","+c+(h?"v"+h+"a"+h+","+h+" 0 0 1 "+h+","+-h:"")+"h"+(d-(h?h:0)-(g?g:0))+(g?"a"+g+","+g+" 0 0 1 "+g+","+g:"")+"v"+(e-(g?g:0)-(k?k:0))+(k?"a"+k+","+k+" 0 0 1 "+-k+","+k:"")+"h"+((k?k:0)+(m?m:0)-d)+(m?"a"+m+","+m+" 0 0 1 "+-m+","+-m:"")+"v"+((m?m:0)+(h?h:0)-e)+"z"}function a(a){a=a.getBoundingClientRect();return{x:a.left,y:a.top}}var h=h||d3_tiny,u=null,m={},
k={},c={};return{edgePadding:{horizontal:30,vertical:20},boxPadding:{horizontal:20,vertical:30},createRoot:function(a,c){return{element:h.select(e("g")).classed("rpd-patch",!0).node()}},createNode:function(a,c,g){function k(a,c,d){a=30+25*(Math.max(a,c)-1);return{width:d.width,height:21+Math.max(a,d.height)}}function u(){var a=z,c=k(A,y,D);if(c.width!==a.width||c.height!==a.height)n.select("rect.rpd-shadow").attr("height",c.height).attr("width",c.width),n.select("rect.rpd-body").attr("height",c.height).attr("width",
c.width),n.select("path.rpd-content").attr("d",d(0,21,c.width,c.height-21,0,0,2,2)),n.select("g.rpd-process").attr("transform","translate("+c.width/2+","+(21+(c.height-21)/2)+")"),z=c}function r(){E.forEach(function(a,c){var d,e;A>=y?(d=0,e=15+25*c):(d=0,e=(30+25*(y-1))/2+25*(-1*(A-1)/2+c));a.attr("transform","translate("+d+","+e+")")});I.forEach(function(a,c){var d,e;y>=A?(d=0,e=15+25*c):(d=0,e=(30+25*(A-1))/2+25*(-1*(y-1)/2+c));a.attr("transform","translate("+d+","+e+")")})}var D=c.size?{width:c.size.width||
100,height:c.size.height||40}:{width:100,height:40};c=k(a.def.inlets?Object.keys(a.def.inlets).length:0,a.def.outlets?Object.keys(a.def.outlets).length:0,D);var w=c.width,x=c.height,G=x-21,n=h.select(e("g")).attr("class","rpd-node");n.append("rect").attr("class","rpd-shadow").attr("width",w).attr("height",x).attr("x",5).attr("y",6).attr("rx",3).attr("ry",3);n.append("path").attr("class","rpd-header").classed("rpd-drag-handle",!0).attr("d",d(0,0,w,21,2,2,0,0));n.append("text").attr("class","rpd-name").text(a.name).attr("x",
5).attr("y",6).style("pointer-events","none");n.append("path").attr("class","rpd-content").attr("d",d(0,21,w,G,0,0,2,2));n.append("rect").attr("class","rpd-body").attr("width",w).attr("height",x).attr("rx",2).attr("ry",2).style("pointer-events","none");n.select(".rpd-header").append(e("title")).text(g?g+" ("+a.type+")":a.type);n.append("g").attr("class","rpd-remove-button").attr("transform","translate("+(w-12)+",1)").call(function(a){a.append("path").attr("d",d(0,0,11,11,2,2,2,3));a.append("text").text("x").attr("x",
3).attr("y",2).style("pointer-events","none")});n.append("g").attr("class","rpd-inlets").attr("transform","translate(0,21)").data({position:{x:0,y:21}});n.append("g").attr("class","rpd-process").attr("transform","translate("+w/2+","+(21+(x-21)/2)+")");n.append("g").attr("class","rpd-outlets").attr("transform","translate("+w+",21)").data({position:{x:w,y:21}});n.classed("rpd-"+a.type.slice(0,a.type.indexOf("/"))+"-toolkit-node",!0).classed("rpd-"+a.type.replace("/","-"),!0);var A=0,y=0,E=[],I=[],z=
c;m[a.id]={inlet:function(a){A++;E.push(a);u();r()},outlet:function(a){y++;I.push(a);u();r()}};return{element:n.node(),size:c}},createInlet:function(a,c){var d=h.select(e("g")).attr("class","rpd-inlet");d.call(function(c){c.append("circle").attr("class","rpd-connector").attr("cx",0).attr("cy",0).attr("r",2.5);c.append("g").attr("class","rpd-value-holder").attr("transform","translate(-15,0)").append("text").attr("class","rpd-value");c.append("text").attr("class","rpd-name").text(a.name).attr("x",10).attr("y",
0)});m[a.node.id].inlet(d);k[a.id]=d.select(".rpd-connector");return{element:d.node()}},createOutlet:function(a,d){var g=h.select(e("g")).attr("class","rpd-outlet");g.call(function(c){c.append("circle").attr("class","rpd-connector").attr("cx",0).attr("cy",0).attr("r",2.5);c.append("g").attr("class","rpd-value-holder").append("text").attr("class","rpd-value").attr("x",10).attr("y",0).style("pointer-events","none");c.append("text").attr("class","rpd-name").text(a.name).attr("x",-10).attr("y",0)});m[a.node.id].outlet(g);
c[a.id]=g.select(".rpd-connector");return{element:g.node()}},createLink:function(a){var c=h.select(e("line")).attr("class","rpd-link");return{element:c.node(),rotate:function(a,d,e,h){c.attr("x1",a).attr("y1",d).attr("x2",e).attr("y2",h)},noPointerEvents:function(){c.style("pointer-events","none")}}},getInletPos:function(c){c=a(k[c.id].node());return{x:c.x+3,y:c.y+3}},getOutletPos:function(d){d=a(c[d.id].node());return{x:d.x+3,y:d.y+3}},getLocalPos:function(c){if(!u)return c;var d=a(u.node());return{x:c.x+
d.x,y:c.y+d.y}},onPatchSwitch:function(a,c){u=h.select(c)},onNodeRemove:function(a){m[a.id]=null}}});(function(){function g(a){return document.createElementNS(m.ns.prefix.svg,a)}function e(d){return function(e,h){var n=D(h,u),v=Rpd.getStyle(n.style,"svg")(n);e=m.select(e).classed("rpd-network",!0);var t,H,b;return{"patch/is-ready":function(a){var h=m.select(document.documentElement);t=m.select(g("svg")).attr("width",h.property("clientWidth")).attr("height",h.property("clientHeight"));t.append("rect").attr("class","rpd-background").attr("width",h.property("clientWidth")).attr("height",h.property("clientHeight"));
var L=t.append(v.createRoot(d,e).element).classed("rpd-style-"+n.style,!0).classed("rpd-values-"+(n.valuesOnHover?"on-hover":"always-shown"),!0).classed("rpd-show-boxes",n.showBoxes).data(a.patch);c.patches[d.id]=t.data({root:L,width:h.property("clientWidth"),height:h.property("clientHeight"),patch:a.patch});c.patchToPlacing[d.id]=new k.Placing(v);c.patchToLinks[d.id]=new r;H=new p(t,v,n);n.nodeMovingAllowed&&(b=new k.DragAndDrop(t,v));Kefir.fromEvents(t.node(),"selectstart").onValue(w);Kefir.fromEvents(window,
"resize").map(function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}).onValue(function(a){t.attr("height",a);t.data().height=a})},"patch/enter":function(a){q=a.patch;l.switch(a.patch);var b=c.patches[a.patch.id];e.append(b.node());c.patchToLinks[a.patch.id].updateAll();if(v.onPatchSwitch)v.onPatchSwitch(q,b.node())},"patch/exit":function(a){q=null;t.remove()},"patch/refer":function(a){var b=c.nodes[a.node.id];b.select(".rpd-node").classed("rpd-patch-reference",
!0);b.data().processTarget.append(g("text")).text("["+(a.target.name||a.target.id)+"]");Kefir.fromEvents(b.data().processTarget.node(),"click").onValue(function(a,c){return function(){a.exit();c.enter()}}(d,a.target))},"patch/add-node":function(a){var e=a.node,h=a.render;a=c.patchToPlacing[a.patch.id];var k=c.patches[q.id].data(),t=m.select(g("g")).attr("class","rpd-node-box"),l=v.createNode(e,h,C[e.type]),u=t.append(l.element);c.nodes[e.id]=t.data({inletsTarget:u.select(".rpd-inlets"),outletsTarget:u.select(".rpd-outlets"),
processTarget:u.select(".rpd-process"),position:p,size:l.size});var p=a.nextPosition(e,l.size,{width:k.width,height:k.height});e.move(p.x,p.y);var H=new r;c.nodeToLinks[e.id]=H;if(n.nodeMovingAllowed){var z=u.select(".rpd-shadow"),p=u.select(".rpd-drag-handle");p.empty()||b.add(p,{start:function(){u.classed("rpd-dragging",!0);z.empty()||z.attr("x",7).attr("y",8);return t.data().position},drag:function(a){t.attr("transform","translate("+a.x+","+a.y+")");H.forEach(function(a){a.update()})},end:function(a){e.move(a.x,
a.y);z.empty()||z.attr("x",5).attr("y",6);u.classed("rpd-dragging",!1)}})}h.prepare&&h.prepare.bind(e)(c.patches[d.id].node(),c.patches[q.id].node());h.first&&E(e,h.first.bind(e)(u.select(".rpd-process").node()));if(h.always)e.event["node/process"].throttle(100).onValue(function(){H.updateAll()});if(!u.select(".rpd-remove-button").empty())Kefir.fromEvents(u.select(".rpd-remove-button path").node(),"click").map(x).onValue(function(){d.removeNode(e)});c.patches[e.patch.id].data().root.append(t.node())},
"patch/remove-node":function(a){a=a.node;var b=c.nodes[a.id];c.nodeToLinks[a.id].forEach(function(a){a.get().disconnect()});b.remove();if(v.onNodeRemove)v.onNodeRemove(a);c.nodes[a.id]=null;c.nodeToLinks[a.id]=null},"node/move":function(a){var b=c.nodes[a.node.id];a=a.position;b.attr("transform","translate("+Math.floor(a[0])+","+Math.floor(a[1])+")");b.data().position={x:a[0],y:a[1]}},"node/process":function(a){var b=a.node,d=a.render;if(d.always){var e=c.nodes[b.id].data().processTarget.node();d.always.bind(b)(e,
a.inlets,a.outlets)}},"node/add-inlet":function(b){var d=b.inlet;if(!d.hidden){var e=c.nodes[b.node.id].data().inletsTarget;b=b.render;var h;h=m.select(v.createInlet(d,b).element);h.classed("rpd-"+d.type.replace("/","-"),!0);h.classed({"rpd-stale":!0,"rpd-readonly":d.readonly,"rpd-cold":d.cold});var k=null;!d.readonly&&b.edit&&(k=new a(d,b,t,h.select(".rpd-value-holder"),h.select(".rpd-value"),m.select(g("g"))),h.select(".rpd-value-holder").append(k.editorElm.node()));c.inlets[d.id]=h.data({connector:h.select(".rpd-connector"),
value:h.select(".rpd-value"),vlinks:new r,editor:k});d.event["inlet/update"].onError(function(){A(d.id,h,n.effectTime)});H.subscribeInlet(d,h.select(".rpd-connector"));e.append(h.node())}},"node/add-outlet":function(a){var b=a.outlet,d=c.nodes[a.node.id].data().outletsTarget;a=m.select(v.createOutlet(b,a.render).element);a.classed("rpd-"+b.type.replace("/","-"),!0);a.classed("rpd-stale",!0);c.outlets[b.id]=a.data({connector:a.select(".rpd-connector"),value:a.select(".rpd-value"),vlinks:new r});H.subscribeOutlet(b,
a.select(".rpd-connector"));d.append(a.node())},"node/remove-inlet":function(a){a=a.inlet;c.inlets[a.id].data().vlinks.forEach(function(a){a.get().disconnect()});c.inlets[a.id].remove();if(v.onInletRemove)v.onInletRemove(a);c.inlets[a.id]=null},"node/remove-outlet":function(a){a=a.outlet;c.outlets[a.id].data().vlinks.forEach(function(a){a.get().disconnect()});c.outlets[a.id].remove();if(v.onOutletRemove)v.onOutletRemove(a);c.outlets[a.id]=null},"inlet/update":function(a){var b=a.inlet;if(!b.hidden){var d=
a.render,e=c.inlets[b.id],h=e.data().value;if(!h.empty()){var g=b.def.show?b.def.show(a.value):a.value;d.show?d.show.bind(b)(h.node(),a.value,g):h.text(g)}y(b.id,e,n.effectTime)}},"outlet/update":function(a){var b=a.outlet,d=a.render,e=c.outlets[b.id],h=e.data().value;if(!h.empty()){var g=b.def.show?b.def.show(a.value):a.value;d.show?d.show.bind(b)(h.node(),a.value,g):h.text(g)}y(b.id,e,n.effectTime)},"outlet/connect":function(a){a=a.link;var b=a.outlet,e=a.inlet,h=c.inlets[e.id],g=c.outlets[b.id].data(),
h=h.data();if(!n.inletAcceptsMultipleLinks&&1===h.vlinks.count())throw Error("Inlet is already connected to a link");h.editor&&h.editor.disable();var k=new B(a,v);k.construct(n.linkWidth).rotateOI(b,e);m.select(k.getElement()).classed("rpd-"+e.type.replace("/","-"),!0).classed("rpd-"+b.type.replace("/","-"),!0);c.links[a.id]=k;g.vlinks.add(k);h.vlinks.add(k);c.nodeToLinks[b.node.id].add(k);b.node.id!==e.node.id&&c.nodeToLinks[e.node.id].add(k);c.patchToLinks[d.id].add(k);k.listenForClicks();k.appendTo(t)},
"outlet/disconnect":function(a){a=a.link;var b=c.links[a.id],e=a.outlet,h=a.inlet,g=c.outlets[e.id].data(),k=c.inlets[h.id].data();c.links[a.id]=null;g.vlinks.remove(b);k.vlinks.remove(b);c.nodeToLinks[e.node.id].remove(b);e.node.id!==h.node.id&&c.nodeToLinks[h.node.id].remove(b);c.patchToLinks[d.id].remove(b);b.removeFrom(t)},"link/enable":function(a){var b=c.inlets[a.link.inlet.id].data();b.editor&&b.editor.disable();c.links[a.link.id].enable()},"link/disable":function(a){c.links[a.link.id].disable()}}}}
function d(a,c){return Kefir.merge([a.map(h(!0)),c.map(h(!1))]).toProperty(h(!1))}function a(a,d,e,g,k,t){var m=Kefir.emitter(),b=Kefir.emitter();this.disableEditor=b;this.editorElm=t;this.valueElm=k;t.classed("rpd-value-editor",!0);d.edit.bind(a)(t.node(),a,m).onValue(function(c){a.receive(c)});Kefir.combine([Kefir.merge([Kefir.fromEvents(g.node(),"click").map(x).map(h(!0)),Kefir.fromEvents(e.node(),"click").merge(b).map(h(!1))]).toProperty(h(!1)).skipDuplicates()],[a.event["inlet/update"]]).map(function(a){return{lastValue:a[1],
startEditing:a[0],cancelEditing:!a[0]}}).onValue(function(b){if(b.startEditing){var d=c.inlets[a.id].data();d.link&&d.link.disable();m.emit(b.lastValue);g.classed("rpd-editor-enabled",!0)}else b.cancelEditing&&(k.classed("rpd-edited",!0),g.classed("rpd-editor-enabled",!1))});g.classed("rpd-editor-disabled",!0)}var h=Rpd.unit,u={style:"quartz",valuesOnHover:!1,showBoxes:!1,nodeMovingAllowed:!0,renderNodeList:!0,nodeListCollapsed:!0,inletAcceptsMultipleLinks:!1,effectTime:1E3},m=m||d3_tiny,k=Rpd.Render,
c={patches:{},nodes:{},inlets:{},outlets:{},links:{},patchToPlacing:{},patchToLinks:{},nodeToLinks:{}},l=new k.Navigation(function(a){return function(c){return a.patches[c].data().patch}}(c)),q,C=Rpd.allNodeDescriptions,p=function(){function a(d){return c.inlets[d.id].data().vlinks}function e(c){return function(){return 0<a(c).count()}}function g(a){1===a.count()&&(a=a.getLast().link,a.outlet.disconnect(a))}function k(a,c){a.forEach(function(a){a.link.outlet.id===c.id&&c.disconnect(a.link)})}function l(a,
c,b){this.root=a;this.style=c;this.config=b;this.rootClicks=Kefir.fromEvents(this.root.node(),"click");this.inletClicks=Kefir.pool();this.outletClicks=Kefir.pool();this.startLink=Kefir.emitter();this.finishLink=Kefir.emitter();this.doingLink=d(this.startLink,this.finishLink)}l.prototype.subscribeOutlet=function(c,e){var b=this.root,f=this.style,l=this.config,u=this.rootClicks,q=this.outletClicks,p=this.inletClicks,r=this.startLink,v=this.finishLink,C=this.doingLink;q.plug(Kefir.fromEvents(e.node(),
"click").map(G).map(n(c)));Kefir.fromEvents(e.node(),"click").map(x).filterBy(d(q,C)).map(G).onValue(function(d){r.emit();var e=(new B(null,f)).construct(l.linkWidth).rotateO(c,d.x,d.y).noPointerEvents().appendTo(b);m.select(e.getElement()).classed("rpd-"+c.type.replace("/","-"),!0);Kefir.fromEvents(b.node(),"mousemove").takeUntilBy(Kefir.merge([p,q.map(h(!1)),u.map(h(!1))]).take(1).onValue(function(b){if(b){b=b.target;var d=a(b);l.inletAcceptsMultipleLinks?k(d,c):g(d);c.connect(b)}})).map(G).map(f.getLocalPos).onValue(function(a){e.rotateO(c,
a.x,a.y)}).onEnd(function(){e.removeFrom(b);v.emit()})})};l.prototype.subscribeInlet=function(c,l){var b=this.root,f=this.style,u=this.config,q=this.rootClicks,p=this.outletClicks,r=this.inletClicks,v=this.startLink,C=this.finishLink,w=this.doingLink;r.plug(Kefir.fromEvents(l.node(),"click").map(G).map(n(c)));Kefir.fromEvents(l.node(),"click").map(x).filterBy(d(r,w)).filter(e(c)).onValue(function(d){var e=a(c).getLast().link,l=e.outlet;l.disconnect(e);v.emit();var n=(new B(null,f)).construct(u.linkWidth).rotateO(l,
d.x,d.y).noPointerEvents().appendTo(b);m.select(n.getElement()).classed("rpd-"+c.type.replace("/","-"),!0).classed("rpd-"+l.type.replace("/","-"),!0);Kefir.fromEvents(b.node(),"mousemove").takeUntilBy(Kefir.merge([r,p.map(h(!1)),q.map(h(!1))]).take(1).onValue(function(c){if(c){c=c.target;var b=a(c);u.inletAcceptsMultipleLinks?k(b,l):g(b);l.connect(c)}})).map(G).map(f.getLocalPos).onValue(function(a){n.rotateO(l,a.x,a.y)}).onEnd(function(){n.removeFrom(b);C.emit()})})};return l}();a.prototype.disable=
function(){this.valueElm.classed("rpd-edited",!1);this.disableEditor.emit()};var B=k.VLink,r=k.VLinks,D=k.mergeConfig,w=k.preventDefault,x=k.stopPropagation,G=k.extractPos,n=k.addTarget,A=k.addValueErrorEffect,y=k.addValueUpdateEffect,E=k.subscribeUpdates;Rpd.SvgRenderer=e;Rpd.renderer("svg",e)})();Rpd.nodedescription("core/custom","May have any number of inlets and outlets, a target for extension.");Rpd.nodetype("core/custom",{name:"Custom"});Rpd.channeltype("core/number",{default:0,readonly:!1,accept:function(g){if(Infinity===g)return!0;g=parseFloat(g);return!isNaN(g)&&isFinite(g)},adapt:function(g){return parseFloat(g)}});
Rpd.channeltype("core/time",{default:1E3,accept:function(g){g=parseFloat(g);return!isNaN(g)&&isFinite(g)},adapt:function(g){return parseFloat(g)},show:function(g){return Math.floor(g/10)/100+"s"}});Rpd.nodetype("core/number",{name:"number",inlets:{"user-value":{type:"core/number",default:0,hidden:!0}},outlets:{out:{type:"core/number"}},process:function(g){return{out:g["user-value"]}}});
Rpd.nodetype("core/random",function(){var g=0;return{name:"random",inlets:{min:{type:"core/number",default:0},max:{type:"core/number",default:100},period:{type:"core/time",default:1E3}},outlets:{out:{type:"core/number"}},process:function(e){if(e.hasOwnProperty("period"))return g++,{out:Kefir.withInterval(e.period,function(d){d.emit(Math.floor(e.min+Math.random()*(e.max-e.min)))}).takeWhile(function(d){return function(){return d===g}}(g))}}}});
Rpd.nodetype("core/bounded-number",{name:"bounded number",inlets:{min:{type:"core/number",default:0},max:{type:"core/number",default:Infinity},spinner:{type:"core/number",default:0,hidden:!0}},outlets:{out:{type:"core/number"}},process:function(g){if(g.hasOwnProperty("spinner"))return{out:g.spinner}}});Rpd.channeltype("core/any",{});Rpd.channeltype("core/boolean",{default:!1,readonly:!1,adapt:function(g){return g?!0:!1}});Rpd.channelrenderer("core/number","svg",{edit:function(g,e,d){e=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");e.setAttributeNS(null,"width",20);e.setAttributeNS(null,"height",30);var a=document.createElementNS("http://www.w3.org/1999/xhtml","input");a.type="number";d.onValue(function(d){a.value=d});e.appendChild(a);g.appendChild(e);return Kefir.fromEvents(a,"change").map(function(){return a.value})}});Rpd.nodedescription("demo/empty","Does not allow adding any inlets or outlets.");Rpd.nodetype("demo/empty",{name:"Empty",handle:{"inlet/add":function(){throw Error("Empty node can not have any inlets");},"outlet/add":function(){throw Error("Empty node can not have any outlets");}}});
Rpd.nodetype("demo/sum-of-three",{name:"Sum of Three",width:1.8,inlets:{a:{type:"core/number",name:"A"},b:{type:"core/number",name:"B"},c:{type:"core/number",name:"C"}},outlets:{sum:{type:"core/number",name:"\u2211"}},process:function(g){return{sum:(g.a||0)+(g.b||0)+(g.c||0)}}});Rpd.nodedescription("demo/hot-and-cold","An example of cold inlet.");
Rpd.nodetype("demo/hot-and-cold",{name:"Hot and Cold",inlets:{hot:{type:"core/number",name:"A",default:1},cold:{type:"core/number",name:"B",default:1,cold:!0}},outlets:{value:{type:"core/any"}},process:function(g){return{value:[g.hot,g.cold]}}});Rpd.noderenderer("demo/sum-of-three","svg",function(){var g;return{size:{width:150,height:null},first:function(e){g=document.createElementNS("http://www.w3.org/2000/svg","text");e.appendChild(g)},always:function(e,d,a){g.innerHTML="\u2211 ("+(d.a||"?")+", "+(d.b||"?")+", "+(d.c||"?")+") = "+(a.sum||"?")}}});(function(g){function e(){var a={},d={},e={},g={},k={};return{"network/add-patch":function(c){a[c.patchId]=Rpd.addPatch(c.patchName)},"patch/enter":function(c){a[c.patchId].enter()},"patch/exit":function(c){a[c.patchId].exit()},"patch/set-inputs":function(c){var d=[];c.inputs.forEach(function(a){d.push(e[a])});a[c.patchId].inputs(d)},"patch/set-outputs":function(c){var d=[];c.outputs.forEach(function(a){d.push(g[a])});a[c.patchId].outputs(d)},"patch/project":function(c){a[c.patchId].project(d[c.nodeId])},
"patch/add-node":function(c){d[c.nodeId]=a[c.patchId].addNode(c.nodeType,c.nodeName)},"patch/remove-node":function(c){a[c.patchId].removeNode(d[c.nodeId])},"node/turn-on":function(a){d[a.nodeId].turnOn()},"node/turn-off":function(a){d[a.nodeId].turnOff()},"node/add-inlet":function(a){e[a.inletId]=d[a.nodeId].addInlet(a.inletType,a.inletName,a.inletAlias)},"node/remove-inlet":function(a){d[a.nodeId].removeInlet(e[a.inletId])},"node/add-outlet":function(a){g[a.outletId]=d[a.nodeId].addOutlet(a.outletType,
a.outletName,a.outletAlias)},"node/remove-outlet":function(a){d[a.nodeId].removeOutlet(g[a.outletId])},"node/move":function(a){var e=a.position;d[a.nodeId].move(e[0],e[1])},"outlet/connect":function(a){k[a.linkId]=g[a.outletId].connect(e[a.inletId])},"outlet/disconnect":function(a){g[a.outletId].disconnect(k[a.linkId])},"link/enable":function(a){k[a.linkId].enable()},"link/disable":function(a){k[a.linkId].disable()}}}Rpd.export.json=function(a){function e(){Object.keys(c).forEach(function(a){m.push(c[a])})}
var g=d,m=[],k={name:a||"Untitled",kind:"RPD Network",version:Rpd.VERSION,commands:m},c={},l=Rpd.events.filter(function(a){return g[a.type]}),q=function(a){"node/move"===a.type?c[a.node.id]=g["node/move"](a):m.push(g[a.type](a))};l.onValue(q);return function(){l.offValue(q);e();return k}};Rpd.import.json=function(a){var d=e();a.version!==Rpd.VERSION&&console&&console.warn&&console.warn("JSON version",a.version,"and RPD Version",Rpd.VERSION,"are not equal to each other");a.commands.forEach(function(a){if(a.event)d[a.event](a)})};
var d={"network/add-patch":function(a){a=a.patch;return{event:"network/add-patch",patchName:a.name,patchId:a.id}},"patch/enter":function(a){return{event:"patch/enter",patchId:a.patch.id}},"patch/exit":function(a){return{event:"patch/exit",patchId:a.patch.id}},"patch/set-inputs":function(a){var d=[];a.inputs.forEach(function(a){d.push(a.id)});return{event:"patch/set-inputs",patchId:a.patch.id,inputs:d}},"patch/set-outputs":function(a){var d=[];a.outputs.forEach(function(a){d.push(a.id)});return{event:"patch/set-outputs",
patchId:a.patch.id,outputs:d}},"patch/project":function(a){return{event:"patch/project",patchId:a.patch.id,targetPatchId:a.target.id,nodeId:a.node.id}},"patch/add-node":function(a){a=a.node;return{event:"patch/add-node",patchId:a.patch.id,nodeType:a.type,nodeName:a.name,nodeId:a.id}},"patch/remove-node":function(a){return{event:"patch/remove-node",patchId:a.patch.id,nodeId:a.node.id}},"node/turn-on":function(a){return{event:"node/turn-on",nodeId:a.node.id}},"node/turn-off":function(a){return{event:"node/turn-off",
nodeId:a.node.id}},"node/add-inlet":function(a){var d=a.inlet;return{event:"node/add-inlet",nodeId:a.node.id,inletId:d.id,inletType:d.type,inletAlias:d.alias,inletName:d.name}},"node/remove-inlet":function(a){return{event:"node/remove-inlet",nodeId:a.node.id,inletId:a.inlet.id}},"node/add-outlet":function(a){var d=a.outlet;return{event:"node/add-outlet",nodeId:a.node.id,outletId:d.id,outletType:d.type,outletAlias:d.alias,outletName:d.name}},"node/remove-outlet":function(a){return{event:"node/remove-outlet",
nodeId:a.node.id,outletId:a.outlet.id}},"node/move":function(a){return{event:"node/move",nodeId:a.node.id,position:a.position}},"outlet/connect":function(a){return{event:"outlet/connect",outletId:a.outlet.id,inletId:a.inlet.id,linkId:a.link.id}},"outlet/disconnect":function(a){return{event:"outlet/disconnect",outletId:a.outlet.id,linkId:a.link.id}},"link/enable":function(a){return{event:"link/enable",linkId:a.link.id}},"link/disable":function(a){return{event:"link/disable",linkId:a.link.id}}}})(this);
