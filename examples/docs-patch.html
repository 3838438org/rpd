<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />

        <!-- Built with RPD v0.2.0-alpha <http://shamansir.github.io/rpd> -->

        <!-- gulp ==renderer svg ==style compact-v ==toolkit core ==target-name rpd ==compilation simple -->

        <!-- RPD Renderer: svg -->
        <link rel="stylesheet" href="../src/render/svg.css"></style>
        <!-- RPD Style: compact-v (svg) -->
        <link rel="stylesheet" href="../src/style/compact-v/svg.css"></style>
        <!-- RPD Toolkit: core (svg) -->
        <link rel="stylesheet" href="../src/toolkit/core/svg.css"></style>

        <!-- Kefir -->
        <script src="../vendor/kefir.min.js"></script>
        <!-- RPD -->
        <script src="../src/rpd.js"></script>

        <!-- RPD's d3_tiny.js -->
        <script src="../src/d3_tiny.js"></script>
        <!-- RPD Rendering Engine: -->
        <script src="../src/render/shared.js"></script>
        <!-- RPD Style: compact-v (svg) -->
        <script src="../src/style/compact-v/svg.js"></script>
        <!-- RPD Renderer: svg -->
        <script src="../src/render/svg.js"></script>
        <!-- RPD Toolkit: core -->
        <script src="../src/toolkit/core/shared.js"></script>
        <script src="../src/toolkit/core/toolkit.js"></script>
        <!-- RPD Toolkit: core (svg) -->
        <script src="../src/toolkit/core/svg.js"></script>

        <style>
            .rpd-node .rpd-header {
                fill: rgba(160,107,154,0.95);
            }

            .rpd-node .rpd-content {
                fill: rgba(141,158,198,0.9);
            }

            /* 203, 118, 158 */
            /* 224, 152, 145 */
            /* 232, 185, 171 */
            /* 215, 192, 208 */
            /* 124, 132, 131 */
            /* 172, 221, 231 */
            /* 154, 213, 202 */

            .rpd-node .rpd-shadow {
                opacity: 0.3;
                fill: rgb(172, 221, 231);
            }
        </style>

    </head>

    <body>

        <canvas id="target"></canvas>

        <script>
            Rpd.renderNext('svg', document.body, { style: 'compact-v' });

            var patch = Rpd.addPatch('Docs Patch');

            patch.addNode('core/empty', 'Empty');

            var LOGO_SUN_REF = '#Oval-1';
            var LOGO_NEPTUNE_REF = '#Oval-2';

            var width = 500,
                height = 140;

            var planets = [
                    { name: 'Sun', size: 109.3, colors: [ '#fda42b', '#f96e22', '#f00e1a' ] },      /*0*/
                    { name: 'Mercury', size: 0.3829, colors: [ '#b5adaa', '#535355', '#232323' ] }, /*1*/
                    { name: 'Venus', size: 0.9499, colors: [ '#cdc8c2', '#615d41', '#525355' ] },   /*2*/
                    { name: 'Earth', size: 1.0, colors: [ '#314051', '#b79a76', '#e8f1e2' ] },      /*3*/
                    { name: 'Mars', size: 0.5320, colors: [ '#ed955f', '#b3734a', '#163c6a' ] },    /*4*/
                    { name: 'Jupiter', size: 10.97, colors: [ '#f0eff4', '#935f51', '#cbbaa1' ] },  /*5*/
                    { name: 'Saturn', size: 9.140, colors: [ '#dfceb0', '#b99a7d', '#d7c4d2' ] },   /*6*/
                    { name: 'Uranus', size: 3.981, colors: [ '#cef4f5', '#acd3d8', '#49696d' ] },   /*7*/
                    { name: 'Neptune', size: 3.865, colors: [ '#466aff', '#3948bf', '#1e2051' ] }   /*8*/
                    //{ name: "Pluto", size: 0.186 }     /*9*/
                ];

            function addPlanets(root, logoRef, config, width, height) {

                var sunInitial, neptuneInitial;

                var logoWidth, logoHeight,
                    logoViewBoxWidth, logoViewBoxHeight;

                d3.select(logoRef).call(function(logoRef) {
                    sunInitial = logoRef.select(LOGO_SUN_REF);
                    neptuneInitial = logoRef.select(LOGO_NEPTUNE_REF);

                    logoWidth = parseInt(logoRef.attr('width'));
                    logoHeight = parseInt(logoRef.attr('height'));

                    var viewBox = logoRef.attr('viewBox').split(' ');
                    logoViewBoxWidth = viewBox[2];
                    logoViewBoxHeight = viewBox[3];
                });

                var defs = d3.select(root).append('svg:defs');

                var gradients = [];
                var stop_distribution = ['0%', '60%', '100%'];

                defs.selectAll('radialGradient')
                    .data(planets)
                    .enter().append('radialGradient')
                    .attr('id', function(planet) { return 'gradient-' + planet.name; })
                    .attr('gradientUnits', 'objectBoundingBox')
                    .attr('cx', '0')
                    .attr('cy', '0')
                    .attr('r', '100%')
                    .each(function() {
                        d3.select(this).selectAll('stop')
                          .data(function(planet) { return planet.colors; })
                          .enter().append('stop')
                          .attr('offset', function(color, i) { return stop_distribution[i]; })
                          .attr('stop-color', 'black')
                          .attr('stop-opacity', 1)
                    });

                d3.select(root).append('g').selectAll('g')
                  .data(planets)
                  .enter().append('g').classed('planet', true).append('circle')
                  .attr('cx', function(planet) {
                       return (planet.name !== 'Neptune') ? (sunInitial.attr('cx') / logoViewBoxWidth * logoWidth)
                                                          : (neptuneInitial.attr('cx') / logoViewBoxWidth * logoWidth);
                   })
                  .attr('cy', function(planet) {
                       return (planet.name !== 'Neptune') ? (sunInitial.attr('cy') / logoViewBoxHeight * logoHeight)
                                                          : (neptuneInitial.attr('cy') / logoViewBoxHeight * logoHeight);
                   })
                  .attr('r', function(planet) {
                       return (planet.name !== 'Neptune') ? (sunInitial.attr('r') / logoViewBoxWidth * logoWidth)
                                                          : (neptuneInitial.attr('r') / logoViewBoxWidth * logoWidth);
                   })
                  .attr('fill', function(planet) { return 'url(#gradient-' + planet.name + ')'; })
                  .attr('stroke-width', function(planet) {
                        return (planet.name !== 'Neptune') ? 0 : (neptuneInitial.attr('stroke-width') / logoViewBoxWidth * logoWidth);
                   })
                  .attr('stroke', function(planet) { return (planet.name !== 'Neptune') ? 'black' : 'white'; });

                return function() {
                    var step = width / planets.length;
                    var proportion = logoHeight / planets[5].size * 0.47; //* 0.85;
                    //var proportion = logoHeight;

                    d3.select(root).selectAll('g.planet > circle')
                      .transition().duration(5000)
                      .attr('r', function(planet, i) { return (planet.size * proportion) / 2; })
                      .attr('cx', function(_, i) { return (planets.length - (i/* + 1*/)) * step; });

                    d3.select(defs.node()).selectAll('radialGradient')
                      .each(function(planet, i) {
                          d3.select(this).selectAll('stop').each(function() {
                              d3.select(this)
                                .transition().duration(5000)
                                .attr('stop-color', function(toColor) { return toColor; });
                          });
                      });

                };
            }

            var animate = addPlanets(document.getElementById('planets'), document.getElementById('rpd-logo'), {}, 500, 140);
            animate();
        </script>
    </body>
</html>
