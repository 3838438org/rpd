<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />

        <!-- Built with RPD v0.2.0-alpha <http://shamansir.github.io/rpd> -->

        <!-- gulp ==renderer svg ==style compact-v ==toolkit core ==target-name rpd ==compilation simple -->

        <!-- RPD Renderer: svg -->
        <link rel="stylesheet" href="../src/render/svg.css"></style>
        <!-- RPD Style: compact-v (svg) -->
        <link rel="stylesheet" href="../src/style/compact-v/svg.css"></style>
        <!-- RPD Toolkit: core (svg) -->
        <link rel="stylesheet" href="../src/toolkit/core/svg.css"></style>

        <!-- Kefir -->
        <script src="../vendor/kefir.min.js"></script>
        <!-- RPD -->
        <script src="../src/rpd.js"></script>

        <!-- RPD's d3_tiny.js -->
        <script src="../src/d3_tiny.js"></script>
        <!-- RPD Rendering Engine: -->
        <script src="../src/render/shared.js"></script>
        <!-- RPD Style: compact-v (svg) -->
        <script src="../src/style/compact-v/svg.js"></script>
        <!-- RPD Renderer: svg -->
        <script src="../src/render/svg.js"></script>
        <!-- RPD Toolkit: core -->
        <script src="../src/toolkit/core/shared.js"></script>
        <script src="../src/toolkit/core/toolkit.js"></script>
        <!-- RPD Toolkit: core (svg) -->
        <script src="../src/toolkit/core/svg.js"></script>

        <style>
            .rpd-node .rpd-header {
                fill: rgba(160,107,154,0.95);
            }

            .rpd-node .rpd-content {
                fill: rgba(141,158,198,0.9);
            }

            /* 203, 118, 158 */
            /* 224, 152, 145 */
            /* 232, 185, 171 */
            /* 215, 192, 208 */
            /* 124, 132, 131 */
            /* 172, 221, 231 */
            /* 154, 213, 202 */

            .rpd-node .rpd-shadow {
                opacity: 0.3;
                fill: rgb(172, 221, 231);
            }
        </style>

    </head>

    <body>

        <canvas id="target"></canvas>

        <script>
            Rpd.renderNext('svg', document.body, { style: 'compact-v' });

            var patch = Rpd.addPatch('Docs Patch');

            patch.addNode('core/empty', 'Empty');

            var LOGO_SUN_REF = '#Oval-1';
            var LOGO_NEPTUNE_REF = '#Oval-2';

            var width = 500,
                height = 140;

            var planets = [
                    { name: "Sun", size: 109.3 },      /*0*/
                    { name: "Mercury", size: 0.3829 }, /*1*/
                    { name: "Venus", size: 0.9499 },   /*2*/
                    { name: "Earth", size: 1.0 },      /*3*/
                    { name: "Mars", size: 0.5320 },    /*4*/
                    { name: "Jupiter", size: 10.97 },  /*5*/
                    { name: "Saturn", size: 9.140 },   /*6*/
                    { name: "Uranus", size: 3.981 },   /*7*/
                    { name: "Neptune", size: 3.865 }   /*8*/
                    //{ name: "Pluto", size: 0.186 }     /*9*/
                ];

                var gradient = d3.select(root).append("svg:defs")
                  .append("svg:linearGradient")
                    .attr("id", "gradient")
                    .attr("x1", "0%")
                    .attr("y1", "0%")
                    .attr("x2", "100%")
                    .attr("y2", "0%")
                    .attr("spreadMethod", "pad");
                gradient.append("svg:stop")
                    .attr("offset", "0%")
                    .attr("stop-color", "yellow")
                    .attr("stop-opacity", 0.6);
                gradient.append("svg:stop")
                    .attr("offset", "100%")
                    .attr("stop-color", "red")
                    .attr("stop-opacity", 0.6);
                /* svg.append("svg:rect")
                    .attr("width", width)
                    .attr("height", 8)
                    .style("fill", "url(#gradient)"); */

            function addPlanets(root, logoRef, config, width, height) {

                var sunInitial, neptuneInitial;

                var logoWidth, logoHeight,
                    logoViewBoxWidth, logoViewBoxHeight;

                d3.select(logoRef).call(function(logoRef) {
                    sunInitial = logoRef.select(LOGO_SUN_REF);
                    neptuneInitial = logoRef.select(LOGO_NEPTUNE_REF);

                    logoWidth = parseInt(logoRef.attr('width'));
                    logoHeight = parseInt(logoRef.attr('height'));

                    var viewBox = logoRef.attr('viewBox').split(' ');
                    logoViewBoxWidth = viewBox[2];
                    logoViewBoxHeight = viewBox[3];
                });

                d3.select(root)
                  .append('g')
                  .call(function(group) {
                      planets.filter(function(planet) {
                         return planet.name !== 'Neptune';
                      }).forEach(function(planet, i) {
                          group.append('circle')
                               .attr('cx', sunInitial.attr('cx') / logoViewBoxWidth * logoWidth)
                               .attr('cy', sunInitial.attr('cy') / logoViewBoxHeight * logoHeight)
                               .attr('r', sunInitial.attr('r') / logoViewBoxWidth * logoWidth)
                               //.attr('fill', 'rgba(' + (20 * (planets.length - i)) + ', 0, 0, 1)')
                               .attr('fill', 'rgba(255, 0, 0, 1)')
                               .attr('stroke-width', 1)
                               .attr('stroke', 'black')
                               .data(planet);
                      });

                      planets.filter(function(planet) {
                          return planet.name === 'Neptune';
                      }).forEach(function(planet) {
                          group.append('circle')
                               .attr('cx', neptuneInitial.attr('cx') / logoViewBoxWidth * logoWidth)
                               .attr('cy', neptuneInitial.attr('cy') / logoViewBoxHeight * logoHeight)
                               .attr('r', neptuneInitial.attr('r') / logoViewBoxWidth * logoWidth)
                               //.attr('fill', 'rgba(' + (20 * (planets.length - i)) + ', 0, 0, 1)')
                               .attr('fill', 'rgba(255, 0, 0, 1)')
                               //.attr('fill', 'url(#gradient)')
                               .attr('stroke', 'white')
                               .attr('stroke-width', neptuneInitial.attr('stroke-width') / logoViewBoxWidth * logoWidth)
                               .data(planet);
                      });
                  });

                return function() {
                    var step = width / planets.length;
                    var proportion = logoHeight / planets[5].size * 0.4; //* 0.85;

                    d3.select(root).selectAll('circle')
                      .transition().duration(5000)
                      .attr('r', function(_, i) { console.log(i, planets[i].name, planets[i].size, planets[i].size * proportion); return (planets[i].size * proportion) / 2; })
                      .attr('cx', function(_, i) { return (planets.length - (i/* + 1*/)) * step; });

                };
            }

            var animate = addPlanets(document.getElementById('planets'), document.getElementById('rpd-logo'), {}, 500, 140);
            animate();
        </script>
    </body>
</html>
